<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Scott-小白" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="和光同尘,静水流深">
<meta property="og:type" content="website">
<meta property="og:title" content="Scott-小白">
<meta property="og:url" content="http://www.sguotao.com/page/2/index.html">
<meta property="og:site_name" content="Scott-小白">
<meta property="og:description" content="和光同尘,静水流深">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Scott-小白">
<meta name="twitter:description" content="和光同尘,静水流深">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.sguotao.com/page/2/"/>





  <title>Scott-小白</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?760edc77a59a2329550e2d68c6400d9b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Scott-小白</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2012/11/Java-集合框架-2012-11-25-java-collection-4-map.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2012/11/Java-集合框架-2012-11-25-java-collection-4-map.html" itemprop="url">
                  集合框架篇4 Map
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-11-25T00:00:00+08:00">
                2012-11-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2012/11/Java-集合框架-2012-11-25-java-collection-4-map.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2012/11/Java-集合框架-2012-11-25-java-collection-4-map.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.  概述"></a>1.  概述</h2><p>数学中的映射关系在Java中就是通过Map来实现的。它表示，里面存储的元素是一个对（pair）,我们通过一个对象，可以在这个映射关系中找到另外一个和这个对象相关的东西。<br>前面提到的我们对于根据帐号名得到对应的人员的信息，就属于这种情况的应用。我们讲一个人员的帐户名和这人员的信息作了一个映射关系，也就是说，我们把帐户名和人员信息当成了一个“键值对”，“键”就是帐户名，“值”就是人员信息。下面我们先看看Map 接口的常用方法。</p>
<h2 id="2-常用方法"><a href="#2-常用方法" class="headerlink" title="2. 常用方法"></a>2. 常用方法</h2><p>Map 接口不是 Collection 接口的继承。而是从自己的用于维护键-值关联的接口层次结构入手。按定义，该接口描述了从不重复的键到值的映射。<br>我们可以把这个接口方法分成三组操作：改变、查询和提供可选视图。<br>改变操作允许您从映射中添加和除去键-值对。键和值都可以为 null。但是，您不能把 Map 作为一个键或值添加给自身。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
Object put(Object key,Object value)：//用来存放一个键-值对Map中
Object remove(Object key)：//根据key(键)，移除一个键-值对，并将值返回
void putAll(Map mapping) ：//将另外一个Map中的元素存入当前的Map中
void clear() ：//清空当前Map中的元素，查询操作允许您检查映射内容：
Object get(Object key) ：//根据key(键)取得对应的值
boolean containsKey(Object key) ：//判断Map中是否存在某键（key）
boolean containsValue(Object value)://判断Map中是否存在某值(value)
int size()://返回Map中 键-值对的个数
boolean isEmpty() ：//判断当前Map是否为空
</pre>

<p>最后一组方法允许您把键或值的组作为集合来处理。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
public Set keySet() ：//返回所有的键（key），并使用Set容器存放
public Collection values() ：//返回所有的值（Value），并使用Collection存放
public Set entrySet() ：//返回一个实现 Map.Entry 接口的元素 Set
</pre>
因为映射中键的集合必须是唯一的，就使用 Set 来支持。因为映射中值的集合可能不唯一，就使用Collection 来支持。最后一个方法返回一个实现 Map.Entry 接口的元素 Set。
我们看看Map的常用实现类的比较，如下表：
![](http://7u2np3.com1.z0.glb.clouddn.com/blog%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-25%20%E4%B8%8B%E5%8D%889.32.44.png)

下面我们看一个简单的例子：
<?prettify?>
<pre class="prettyprint">
import java.util.*; 
public class MapTest {
public static void main(String[] args) {
        Map map1 = new HashMap();
        Map map2 = new HashMap();
        map1.put("1","aaa1");
        map1.put("2","bbb2");    
        map2.put("10","aaaa10");
        map2.put("11","bbbb11");//根据键 "1" 取得值："aaa1"    
    System.out.println("map1.get(\"1\")="+map1.get("1"));
    // 根据键 "1" 移除键值对"1"-"aaa1"
System.out.println("map1.remove(\"1\")="+map1.remove("1"));    
System.out.println("map1.get(\"1\")="+map1.get("1"));
        map1.putAll(map2);//将map2全部元素放入map1中
        map2.clear();//清空map2
        System.out.println("map1 IsEmpty?="+map1.isEmpty());
        System.out.println("map2 IsEmpty?="+map2.isEmpty());
        System.out.println("map1 中的键值对的个数size = "+map1.size());
        System.out.println("KeySet="+map1.keySet());//set
        System.out.println("values="+map1.values());//Collection
        System.out.println("entrySet="+map1.entrySet());    
        System.out.println("map1 是否包含键：11 = "+map1.containsKey("11"));    
        System.out.println("map1 是否包含值：aaa1 = "+map1.containsValue("aaa1"));
    }
}
</pre>

<p>运行输出结果为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
map1.get("1")=aaa1
map1.remove("1")=aaa1
map1.get("1")=null
map1 IsEmpty?=false
map2 IsEmpty?=true
map1 中的键值对的个数size = 3
KeySet=[10, 2, 11]
values=[aaaa10, bbb2, bbbb11]
entrySet=[10=aaaa10, 2=bbb2, 11=bbbb11]
map1 是否包含键：11 = true
map1 是否包含值：aaa1 = false
</pre>

<p>在该例子中，我们创建一个HashMap，并使用了一下Map接口中的各个方法。<br>其中Map中的entrySet()方法先提一下，该方法返回一个实现 Map.Entry 接口的对象集合。集合中每个对象都是底层 Map 中一个特定的键-值对。</p>
<p>Map.Entry 接口是Map 接口中的一个内部接口，该内部接口的实现类存放的是键值对。在下面的实现原理中，我们会对这方面再作介绍，现在我们先不管这个它的具体实现。</p>
<p>我们再看看排序的Map是如何使用：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
import java.util.*;
public class MapSortExample {
  public static void main(String args[]) {
    Map map1 = new HashMap(); 
    Map map2 = new LinkedHashMap();
    for(int i=0;i<10;i++){ double="" s="Math.random()*100;//产生一个随机数，并将其放入Map中" map1.put(new="" integer((int)="" s),"第="" "+i+"="" 个放入的元素："+s+"\n");="" map2.put(new="" }="" system.out.println("未排序前hashmap："+map1);="" system.out.println("未排序前linkedhashmap："+map2);="" 使用treemap来对另外的map进行重构和排序="" map="" sortedmap="new" treemap(map1);="" system.out.println("排序后："+sortedmap);="" system.out.println("排序后："+new="" treemap(map2));="" <="" pre="">

<p>该程序的一次运行结果为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
未排序前HashMap：{64=第 1 个放入的元素：64.05341725531845
, 15=第 9 个放入的元素：15.249165766266382
, 2=第 4 个放入的元素：2.66794706854534
, 77=第 0 个放入的元素：77.28814965781416
, 97=第 5 个放入的元素：97.32893518378948
, 99=第 2 个放入的元素：99.99412014935982
, 60=第 8 个放入的元素：60.91451419025399
, 6=第 3 个放入的元素：6.286974058646977
, 1=第 7 个放入的元素：1.8261658496439903
, 48=第 6 个放入的元素：48.736039522423106
}
未排序前LinkedHashMap：{77=第 0 个放入的元素：77.28814965781416
, 64=第 1 个放入的元素：64.05341725531845
, 99=第 2 个放入的元素：99.99412014935982
, 6=第 3 个放入的元素：6.286974058646977
, 2=第 4 个放入的元素：2.66794706854534
, 97=第 5 个放入的元素：97.32893518378948
, 48=第 6 个放入的元素：48.736039522423106
, 1=第 7 个放入的元素：1.8261658496439903
, 60=第 8 个放入的元素：60.91451419025399
, 15=第 9 个放入的元素：15.249165766266382
}
排序后：{1=第 7 个放入的元素：1.8261658496439903
, 2=第 4 个放入的元素：2.66794706854534
, 6=第 3 个放入的元素：6.286974058646977
, 15=第 9 个放入的元素：15.249165766266382
, 48=第 6 个放入的元素：48.736039522423106
, 60=第 8 个放入的元素：60.91451419025399
, 64=第 1 个放入的元素：64.05341725531845
, 77=第 0 个放入的元素：77.28814965781416
, 97=第 5 个放入的元素：97.32893518378948
, 99=第 2 个放入的元素：99.99412014935982
}
排序后：{1=第 7 个放入的元素：1.8261658496439903
, 2=第 4 个放入的元素：2.66794706854534
, 6=第 3 个放入的元素：6.286974058646977
, 15=第 9 个放入的元素：15.249165766266382
, 48=第 6 个放入的元素：48.736039522423106
, 60=第 8 个放入的元素：60.91451419025399
, 64=第 1 个放入的元素：64.05341725531845
, 77=第 0 个放入的元素：77.28814965781416
, 97=第 5 个放入的元素：97.32893518378948
, 99=第 2 个放入的元素：99.99412014935982
}
</pre>

<p>从运行结果，我们可以看出，HashMap的存入顺序和输出顺序无关。而LinkedHashMap 则保留了键值对的存入顺序。TreeMap则是对Map中的元素进行排序。在实际的使用中我们也经常这样做：使用HashMap或者LinkedHashMap 来存放元素，当所有的元素都存放完成后，如果使用则是需要一个经过排序的Map的话，我们再使用TreeMap来重构原来的Map对象。这样做的好处是：因为HashMap和LinkedHashMap 存储数据的速度比直接使用TreeMap 要快，存取效率要高。当完成了所有的元素的存放后，我们再对整个的Map中的元素进行排序。这样可以提高整个程序的运行的效率，缩短执行时间。</p>
<p>这里需要注意的是，TreeMap中是根据键（Key）进行排序的。而如果我们要使用TreeMap来进行正常的排序的话，Key 中存放的对象必须实现Comparable 接口。我们简单介绍一下这个接口：</p>
<h2 id="3-Comparable-接口"><a href="#3-Comparable-接口" class="headerlink" title="3. Comparable 接口"></a>3. Comparable 接口</h2><p>在 java.lang 包中，Comparable 接口适用于一个类有自然顺序的时候。假定对象集合是同一类型，该接口允许您把集合排序成自然顺序。</p>
<p>它只有一个方法：compareTo() 方法，用来比较当前实例和作为参数传入的元素。如果排序过程中当前实例出现在参数前（当前实例比参数大），就返回某个负值。如果当前实例出现在参数后（当前实例比参数小），则返回正值。否则，返回零。如果这里不要求零返回值表示元素相等。零返回值可以只是表示两个对象在排序的时候排在同一个位置。</p>
<p>上面例子中的整形的包装类：Integer 就实现了该接口。我们可以看一下这个类的源码：<br>可以看到compareTo 方法里面通过判断当前的Integer对象的值是否大于传入的参数的值来得到返回值的。<br>在 Java 2 SDK，版本 1.2 中有十四个类实现 Comparable 接口。下表展示了它们的自然排序。虽然一些类共享同一种自然排序，但只有相互可比的类才能排序。<br><img src="http://7u2np3.com1.z0.glb.clouddn.com/blog%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-26%20%E4%B8%8A%E5%8D%8811.22.23.png" alt=""></p>
<p>这里只是简单的介绍一下排序接口，如果要详细的了解排序部分内容的话，可以参考文章最后的附录部分对于排序的更加详细的描述。<br>我们再回到Map中来，Java提高的API中除了上面介绍的几种Map比较常用以为还有一些Map，大家可以了解一下：</p>
<ul>
<li>WeakHashMap： WeakHashMap 是 Map 的一个特殊实现，它只用于存储对键的弱引用。当映射的某个键在 WeakHashMap 的外部不再被引用时，就允许垃圾收集器收集映射中相应的键值对。使用 WeakHashMap 有益于保持类似注册表的数据结构，其中条目的键不再能被任何线程访问时，此条目就没用了。</li>
<li>IdentifyHashMap： Map的一种特性实现，关键属性的hash码不是由hashCode()方法计算，而是由  System.identityHashCode 方法计算，使用==进行比较而不是equals()方法。</li>
</ul>
<p>通过简单的对与Map中各个常用实现类的使用，为了更好的理解Map，下面我们再来了解一下Map的实现原理。</p>
<h2 id="4-实现原理"><a href="#4-实现原理" class="headerlink" title="4.实现原理"></a>4.实现原理</h2><p>有的人可能会认为 Map 会继承 Collection。在数学中，映射只是对（pair）的集合。但是，在“集合框架”中，接口 Map 和 Collection 在层次结构没有任何亲缘关系，它们是截然不同的。这种差别的原因与 Set 和 Map 在 Java 库中使用的方法有关。Map 的典型应用是访问按关键字存储的值。它支持一系列集合操作的全部，但操作的是键-值对，而不是单个独立的元素。因此 Map 需要支持 get() 和 put() 的基本操作，而 Set 不需要。此外，还有返回 Map 对象的 Set 视图的方法：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
Set set = aMap.keySet();
</pre>

<p>下面我们以HashMap为例，对Map的实现机制作一下更加深入一点的理解。</p>
<p>因为HashMap里面使用Hash算法，所以在理解HashMap之前，我们需要先了解一下Hash算法和Hash表。</p>
<p>Hash，一般翻译做“散列”，也有直接音译为”哈希”的，就是把任意长度的输入（又叫做 预映射， pre-image），通过散列算法，变换成固定长度的输出，该输出就是散列值。这种转换是一种压缩映射，也就是，散列值的空间通常远小于输入的空间，不同的输入可能 会散列成相同的输出，而不可能从散列值来唯一的确定输入值。</p>
<p>说的通俗一点，Hash算法的意义在于提供了一种快速存取数据的方法,它用一种算法建立键值与真实值之间的对应关系,(每一个真实值只能有一个键值,但是一个键值可以对应多个真实值),这样可以快速在数组等里面存取数据。</p>
<p>我们建立一个HashTable（哈希表），该表的长度为N，然后我们分别在该表中的格子中存放不同的元素。每个格子下面存放的元素又是以链表的方式存放元素。</p>
<ul>
<li>当添加一个新的元素Entry 的时候，首先我们通过一个Hash函数计算出这个Entry元素的Hash值hashcode。通过该hashcode值，就可以直接定位出我们应该把这个Entry元素存入到Hash表的哪个格子中，如果该格子中已经存在元素了，那么只要把新的Entry元存放到这个链表中即可。</li>
<li>如果要查找一个元素Entry的时候，也同样的方式，通过Hash函数计算出这个Entry元素的Hash值hashcode。然后通过该hashcode值，就可以直接找到这个Entry是存放到哪个格子中的。接下来就对该格子存放的链表元素进行逐个的比较查找就可以了。</li>
</ul>
<p>举一个比较简单的例子来说明这个算法的运算方式：<br>假定我们有一个长度为8的Hash表（可以理解为一个长度为8的数组）。在这个Hash表中存放数字：如下表<br><img src="http://7u2np3.com1.z0.glb.clouddn.com/blog%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-26%20%E4%B8%8B%E5%8D%884.17.17.png" alt=""></p>
<p>假定我们的Hash函数为：<br>Hashcode = X%8    ——– 对8 取余数<br>其中X是我们需要放入Hash表中的数字，而这个函数返回的Hashcode就是Hash码。<br>假定我们有下面10个数字需要依次存入到这个Hash表中：<br>11 , 23 , 44 , 9 , 6 , 32 , 12 , 45 , 57 , 89<br>通过上面的Hash函数，我们可以得到分别对应的Hash码：<br>11――3 ; 23――7　；44――4　；9――1；6――6；32――0；12――4；45――5；57――1；89――1；<br>计算出来的Hash码分别代表，该数字应该存放到Hash表中的哪个对应数字的格子中。如果改格子中已经有数字存在了，那么就以链表的方式将数字依次存放在该格子中，如下表：<br><img src="http://7u2np3.com1.z0.glb.clouddn.com/blog%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-26%20%E4%B8%8A%E5%8D%8811.38.06.png" alt=""></p>
<p>Hash表和Hash算法的特点就是它的存取速度比数组差一些，但是比起单纯的链表，在查找和存储方面却要好很多。同时数组也不利于数据的重构而排序等方面的要求。</p>
<p>更具体的说明，读者可以参考数据结构相关方面的书籍。</p>
<p>简单的了解了一下Hash算法后，我们就来看看HashMap的属性有哪些：<br>里面最重要的3个属性：</p>
<ol>
<li>transient Entry[] table: 用来存放键值对的对象Entry数组，也就是Hash表</li>
<li>transient int size：当前Map中存放的键值对的个数</li>
<li>final float loadFactor：负载因子，用来决定什么情况下应该对Entry进行扩容</li>
</ol>
<p>我们Entry 对象是Map接口中的一个内部接口。即是使用它来保存我们的键值对的。</p>
<p>我们看看这个Entry 内部接口在HashMap中的实现：通过查看源码，我们可以看到Entry类有点类似一个单向链表。其中：<br>   final Object key　和　Object value;存放的就是我们放入Map中的键值对。而属性Entry next;表示当前键值对的下一个键值对是哪个Entry。</p>
<p>接下来，我们看看HashMap的主要的构造函数：<br>我们主要看看 public HashMap(int initialCapacity, float loadFactor)<br>因为，另外两个构造函数实行也是同样的方式进行构建一个HashMap 的。该构造函数：</p>
<ol>
<li>首先是判断参数int initialCapacity和float loadFactor是否合法</li>
<li>然后确定Hash表的初始化长度。确定的策略是：通过传进来的参数initialCapacity 来找出第一个大于它的2的次方的数。比如说我们传了18这样的一个initialCapacity 参数，那么真实的table数组的长度为2的5次方，即32。之所以采用这种策略来构建Hash表的长度，是因为2的次方的运算对于现代的处理器来说，可以通过一些方法得到更加好的执行效率。</li>
<li>接下来就是得到重构因子（threshold）了，这个属性也是HashMap中的一个比较重要的属性，它表示，当Hash表中的元素被存放了多少个之后，我们就需要对该Hash表进行重构。</li>
<li>最后就是使用得到的初始化参数capacity 来构建Hash表：Entry[] table。</li>
</ol>
<p>下面我们看看一个键值对是如何添加到HashMap中的。该put方法是用来添加一个键值对（key-value）到Map中，如果Map中已经存在相同的键的键值对的话，那么就把新的值覆盖老的值，并把老的值返回给方法的调用者。如果不存在一样的键，那么就返回null 。我们看看方法的具体实现：</p>
<ol>
<li>首先我们判断如果key为null则使用一个常量来代替该key值，该行为在方法maskNull（）终将key替换为一个非null 的对象k。</li>
<li>计算key值的Hash码：hash</li>
<li>通过使用Hash码来定位，我们应该把当前的键值对存放到Hash表中的哪个格子中。indexFor()方法计算出的结果：i 就是Hash表（table）中的下标。</li>
<li>然后遍历当前的Hash表中table[i]格中的链表。从中判断已否已经存在一样的键(Key)的键值对。如果存在一样的key的键，那么就用新的value覆写老的value，并把老的value返回</li>
<li>如果遍历后发现没有存在同样的键值对，那么就增加当前键值对到Hash表中的第i个格子中的链表中。并返回null 。</li>
</ol>
<p>最后我们看看一个键值对是如何添加到各个格子中的链表中的：<br>我们先看void addEntry(int hash, Object key, Object value, int bucketIndex)方法，该方法的作用就用来添加一个键值对到Hash表的第bucketIndex个格子中的链表中去。这个方法作的工作就是：</p>
<ol>
<li>创建一个Entry对象用来存放键值对。</li>
<li>添加该键值对 —- Entry对象到链表中</li>
<li>最后在size属性加一，并判断是否需要对当前的Hash表进行重构。如果需要就在  void resize(int newCapacity)方法中进行重构。<br>之所以需要重构，也是基于性能考虑。大家可以考虑这样一种情况，假定我们的Hash表只有4个格子，那么我们所有的数据都是放到这4个格子中。如果存储的数据量比较大的话，例如100。这个时候，我们就会发现，在这个Hash表中的4个格子存放的4个长长的链表。而我们每次查找元素的时候，其实相当于就是遍历链表了。这种情况下，我们用这个Hash表来存取数据的性能实际上和使用链表差不多了。 </li>
</ol>
<p>但是如果我们对这个Hash表进行重构，换为使用Hash表长度为200的表来存储这100个数据，那么平均2个格子里面才会存放一个数据。这个时候我们查找的数据的速度就会非常的快。因为基本上每个格子中存放的链表都不会很长，所以我们遍历链表的次数也就很少，这样也就加快了查找速度。但是这个时候又存在了另外的一个问题。我们使用了至少200个数据的空间来存放100个数据，这样就造成至少100个数据空间的浪费。 在速度和空间上面，我们需要找到一个适合自己的中间值。在HashMap中我们通过负载因子（loadFactor）来决定应该什么时候应该重构我们的Hash表，以达到比较好的性能状态。</p>
<p>我们再看看重构Hash表的方法：void resize(int newCapacity)是如何实现的,它的实现方式比较简单：</p>
<ol>
<li>首先判断如果Hash表的长度已经达到最大值，那么就不进行重构了。因为这个时候Hash表的长度已经达到上限，已经没有必要重构了。</li>
<li>然后就是构建新的Hash表</li>
<li>把老的Hash表中的对象数据全部转移到新的Hash表newTable中，并设置新的重构因子threshold</li>
</ol>
<p>对于HashMap中的实现原理，我们就分析到这里。大家可能会发现，HashCode的计算，是用来定位我们的键值对应该放到Hash表中哪个格子中的关键属性。而这个HashCode的计算方法是调用的各个对象自己的实现的hashCode()方法。而这个方法是在Object对象中定义的，所以我们自己定义的类如果要在集合中使用的话，就需要正确的覆写hashCode() 方法。下面就介绍一下应该如何正确覆写hashCode()方法。</p>
<h2 id="5-覆写hashCode"><a href="#5-覆写hashCode" class="headerlink" title="5. 覆写hashCode()"></a>5. 覆写hashCode()</h2><p>在明白了HashMap具有哪些功能，以及实现原理后，了解如何写一个hashCode()方法就更有意义了。当然，在HashMap中存取一个键值对涉及到的另外一个方法为equals ()，因为该方法的覆写在高级特性已经讲解了。这里就不做过多的描述。</p>
<p>设计hashCode（）时最重要的因素就是：无论何时，对同一个对象调用hashCode()都应该生成同样的值。如果在将一个对象用put（）方法添加进HashMap时产生一个hashCode()值，而用get()取出时却产生了另外一个hashCode()值，那么就无法重新取得该对象了。所以，如果你的hashCode()方法依赖于对象中易变的数据，那用户就要小心了，因为此数据发生变化时，hashCode()就会产生一个不同的hash码，相当于产生了一个不同的“键”。</p>
<p>此外，也不应该使hashCode()依赖于具有唯一性的对象信息，尤其是使用this的值，这只能产生很糟糕的hashCode()。因为这样做无法生成一个新的“键”，使之与put()种原始的“键值对”中的“键”相同。例如，如果我们不覆写Object的hashCode()方法，那么调用该方法的时候，就会调用Object的hashCode()方法的默认实现。Object的hashCode（）方法，返回的是当前对象的内存地址。下次如果我们需要取一个一样的“键”对应的键值对的时候，我们就无法得到一样的hashCode值了。因为我们后来创建的“键”对象已经不是存入HashMap中的那个内存地址的对象了。</p>
<p>我们看一个简单的例子，就能更加清楚的理解上面的意思。假定我们写了一个类：  Person （人），我们判断一个对象“人”是否指向同一个人，只要知道这个人的身份证号一直就可以了。先看我们没有实现hashCode的情况：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
package c08.hashEx;
import java.util.*;
//身份证类
class Code{
    final int id;//身份证号码已经确认,不能改变
    Code(int i){
        id=i;
    }
    //身份号号码相同，则身份证相同
    public boolean equals(Object anObject) {
        if (anObject instanceof Code){
            Code other=(Code) anObject;
            return this.id==other.id;
        }
return false;
    }
    public String toString() {
        return "身份证:"+id;
    }    
}
//人员信息类
class Person {
    Code id;// 身份证
    String name;// 姓名
    public Person(String name, Code id) {
        this.id=id;
        this.name=name;
    }
    //如果身份证号相同，就表示两个人是同一个人
    public boolean equals(Object anObject) {
        if (anObject instanceof Person){
            Person other=(Person) anObject;
            return this.id.equals(other.id);
        }
        return false;
    }
    public String toString() {
        return "姓名:"+name+" 身份证:"+id.id+"\n";
    }
}
public class HashCodeEx {
    public static void main(String[] args) {
        HashMap map=new HashMap();
        Person p1=new Person("张三",new Code(123));
    map.put(p1.id,p1);//我们根据身份证来作为key值存放到Map中
        Person p2=new Person("李四",new Code(456));
        map.put(p2.id,p2);
        Person p3=new Person("王二",new Code(789));
        map.put(p3.id,p3);
        System.out.println("HashMap 中存放的人员信息:\n"+map);
        // 张三 改名为：张山 但是还是同一个人。
        Person p4=new Person("张山",new Code(123));
map.put(p4.id,p4);
        System.out.println("张三改名后 HashMap 中存放的人员信息:\n"+map);
        //查找身份证为：123 的人员信息
        System.out.println("查找身份证为：123 的人员信息:"+map.get(new Code(123)));
    }
}
</pre>

<p>运行结果为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
HashMap 中存放的人员信息:
{身份证:456=姓名:李四 身份证:456
, 身份证:123=姓名:张三 身份证:123
, 身份证:789=姓名:王二 身份证:789
}
张三改名后 HashMap 中存放的人员信息:
{身份证:456=姓名:李四 身份证:456
, 身份证:123=姓名:张三 身份证:123
, 身份证:123=姓名:张山 身份证:123
, 身份证:789=姓名:王二 身份证:789
}
查找身份证为：123 的人员信息:null
</pre>

<p>上面的例子的演示的是，我们在一个HashMap中存放了一些人员的信息。并以这些人员的身份证最为人员的“键”。当有的人员的姓名修改了的情况下，我们需要更新这个HashMap。同时假如我们知道某个身份证号，想了解这个身份证号对应的人员信息如何，我们也可以根据这个身份证号在HashMap中得到对应的信息。</p>
<p>而例子的输出结果表示，我们所做的更新和查找操作都失败了。失败的原因就是我们的身份证类：Code 没有覆写hashCode()方法。这个时候，当查找一样的身份证号码的键值对的时候，使用的是默认的对象的内存地址来进行定位。这样，后面的所有的身份证号对象new Code(123) 产生的hashCode()值都是不一样的。所以导致操作失败。</p>
<p>下面，我们给Code类加上hashCode（）方法，然后再运行一下程序看看：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
//身份证类
class Code{
    final int id;//身份证号码已经确认,不能改变
    Code(int i){
        id=i;
    }
    //身份号号码相同，则身份证相同
    public boolean equals(Object anObject) {
if (anObject instanceof Code){
            Code other=(Code) anObject;
            return this.id==other.id;
        }
        return false;
    }
    public String toString() {
        return "身份证:"+id;
    }    
    //覆写hashCode方法，并使用身份证号作为hash值
    public int hashCode(){
        return id;
    }
}
</pre>

<p>再次执行上面的HashCodeEx 的结果就为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
HashMap 中存放的人员信息:
{身份证:456=姓名:李四 身份证:456
, 身份证:789=姓名:王二 身份证:789
, 身份证:123=姓名:张三 身份证:123
}
张三改名后 HashMap 中存放的人员信息:
{身份证:456=姓名:李四 身份证:456
, 身份证:789=姓名:王二 身份证:789
, 身份证:123=姓名:张山 身份证:123
}
查找身份证为：123 的人员信息:姓名:张山 身份证:123
</pre>

<p>这个时候，我们发现。我们想要做的更新和查找操作都成功了。</p>
<p>对于Map部分的使用和实现，主要就是需要注意存放“键值对”中的对象的equals()方法和hashCode()方法的覆写。如果需要使用到排序的话，那么还需要实现Comparable 接口中的compareTo() 方法。我们需要注意Map中的“键”是不能重复的，而是否重复的判断，是通过调用“键”对象的equals（）方法来决定的。而在HashMap中查找和存取“键值对”是同时使用hashCode（）方法和equals（）方法来决定的。</p>
</10;i++){></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2012/11/Java-集合框架-2012-11-23-java-collection-2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2012/11/Java-集合框架-2012-11-23-java-collection-2.html" itemprop="url">
                  集合框架篇2 Collection
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-11-22T22:40:00+08:00">
                2012-11-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2012/11/Java-集合框架-2012-11-23-java-collection-2.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2012/11/Java-集合框架-2012-11-23-java-collection-2.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-常用方法"><a href="#1-常用方法" class="headerlink" title="1.常用方法"></a>1.常用方法</h2><p>Collection 接口用于表示任何对象或元素组。想要尽可能以常规方式处理一组元素时，就使用这一接口。Collection 在前面的大图也可以看出，它是List和Set 的父类。并且它本身也是一个接口。它定义了作为集合所应该拥有的一些方法。如下：<br>注意:<strong>集合必须只有对象，集合中的元素不能是基本数据类型</strong>。</p>
<h3 id="1-1-添加和删除操作"><a href="#1-1-添加和删除操作" class="headerlink" title="1.1 添加和删除操作"></a>1.1 添加和删除操作</h3><p>Collection接口支持如添加和删除等基本操作。设法除去一个元素时，如果这个元素存在，除去的仅仅是集合中此元素的一个实例。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
boolean add(Object element)   
boolean remove(Object element) 
</pre>

<h3 id="1-2-查询操作"><a href="#1-2-查询操作" class="headerlink" title="1.2 查询操作"></a>1.2 查询操作</h3><p>Collection 接口还支持查询操作：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
int size()   
boolean isEmpty()   
boolean contains(Object element)   
Iterator iterator() 
</pre>

<h3 id="1-3-组操作"><a href="#1-3-组操作" class="headerlink" title="1.3 组操作"></a>1.3 组操作</h3><p>组操作 ：Collection 接口支持的其它操作，要么是作用于元素组的任务，要么是同时作用于整个集合的任务。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
boolean containsAll(Collection collection)   
boolean addAll(Collection collection)   
void clear()   
void removeAll(Collection collection)   
void retainAll(Collection collection)  
</pre>

<ul>
<li>containsAll() 方法允许您查找当前集合是否包含了另一个集合的所有元素，即另一个集合是否是当前集合的子集。其余方法是可选的，因为特定的集合可能不支持集合更改。 </li>
<li>addAll() 方法确保另一个集合中的所有元素都被添加到当前的集合中，通常称为并。 </li>
<li>clear() 方法从当前集合中除去所有元素。 </li>
<li>removeAll() 方法类似于 clear() ，但只除去了元素的一个子集。 </li>
<li>retainAll() 方法类似于 removeAll() 方法，不过可能感到它所做的与前面正好相反：它从当前集合中除去不属于另一个集合的元素，即交。</li>
</ul>
<p>我们看一个简单的例子，来了解一下集合类的基本方法的使用：</p>
<p>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
import java.util.*;  
public class CollectionToArray {  
    public static void main(String[] args) {          
        Collection collection1=new ArrayList();//创建一个集合对象  
        collection1.add("000");//添加对象到Collection集合中  
        collection1.add("111");  
        collection1.add("222");  
        System.out.println("集合collection1的大小："+collection1.size());  
        System.out.println("集合collection1的内容："+collection1);  
        collection1.remove("000");//从集合collection1中移除掉 "000" 这个对象  
        System.out.println("集合collection1移除 000 后的内容："+collection1);  
        System.out.println("集合collection1中是否包含000 ："+collection1.contains("000"));  
        System.out.println("集合collection1中是否包含111 ："+collection1.contains("111"));  
        Collection collection2=new ArrayList();  
    collection2.addAll(collection1);//将collection1 集合中的元素全部都加到collection2中  
        System.out.println("集合collection2的内容："+collection2);  
        collection2.clear();//清空集合 collection1 中的元素  
        System.out.println("集合collection2是否为空 ："+collection2.isEmpty());  
        //将集合collection1转化为数组  
        Object s[]= collection1.toArray();  
        for(int i=0;i<s.length;i++){ system.out.println(s[i]);="" }="" <="" pre="">

<p>运行结果为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
集合collection1的大小：3  
集合collection1的内容：[000, 111, 222]  
集合collection1移除 000 后的内容：[111, 222]  
集合collection1中是否包含000 ：false  
集合collection1中是否包含111 ：true  
集合collection2的内容：[111, 222]  
集合collection2是否为空 ：true  
111  
222  
</pre>

<p>这里需要注意的是，Collection 它仅仅只是一个接口，而我们真正使用的时候，确是创建该接口的一个实现类。做为集合的接口，它定义了所有属于集合的类所都应该具有的一些方法。而ArrayList （列表）类是集合类的一种实现方式。<br>这里需要一提的是，因为Collection的实现基础是数组，所以有转换为Object数组的方法：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
Object[] toArray()   
Object[] toArray(Object[] a)  
</pre>

<p>其中第二个方法Object[]toArray(Object[] a) 的参数 a 应该是集合中所有存放的对象的类的父类。</p>
<h2 id="2-迭代器"><a href="#2-迭代器" class="headerlink" title="2. 迭代器"></a>2. 迭代器</h2><p>任何容器类，都必须有某种方式可以将东西放进去，然后由某种方式将东西取出来。毕竟，存放事物是容器最基本的工作。对于ArrayList，add（）是插入对象的方法，而get()是取出元素的方式之一。ArrayList很灵活，可以随时选取任意的元素，或使用不同的下标一次选取多个元素。</p>
<p>如果从更高层的角度思考，会发现这里有一个缺点：要使用容器，必须知道其中元素的确切类型。初看起来这没有什么不好的，但是考虑如下情况：如果原本是ArrayList ，但是后来考虑到容器的特点，你想换用Set ，应该怎么做？或者你打算写通用的代码，它们只是使用容器，不知道或者说不关心容器的类型，那么如何才能不重写代码就可以应用于不同类型的容器？</p>
<p>所以迭代器(Iterator)的概念，也是出于一种设计模式就是为达成此目的而形成的。所以Collection不提供get()方法。如果要遍历Collectin中的元素，就必须用Iterator。</p>
<p>迭代器（Iterator）本身就是一个对象，它的工作就是遍历并选择集合序列中的对象，而客户端的程序员不必知道或关心该序列底层的结构。此外，迭代器通常被称为“轻量级”对象，创建它的代价小。但是，它也有一些限制，例如，某些迭代器只能单向移动。</p>
<p>Collection 接口的 iterator() 方法返回一个 Iterator。Iterator 和您可能已经熟悉的 Enumeration 接口类似。使用 Iterator 接口方法，您可以从头至尾遍历集合，并安全的从底层 Collection 中除去元素。</p>
<p>下面，我们看一个对于迭代器的简单使用：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
import java.util.ArrayList;  
import java.util.Collection;  
import java.util.Iterator;  
public class IteratorDemo {  
    public static void main(String[] args) {  
        Collection collection = new ArrayList();  
        collection.add("s1");  
        collection.add("s2");  
        collection.add("s3");  
Iterator iterator = collection.iterator();//得到一个迭代器  
        while (iterator.hasNext()) {//遍历  
            Object element = iterator.next();  
            System.out.println("iterator = " + element);  
        }  
        if(collection.isEmpty())  
            System.out.println("collection is Empty!");  
        else  
            System.out.println("collection is not Empty! size="+collection.size());  
        Iterator iterator2 = collection.iterator();  
        while (iterator2.hasNext()) {//移除元素  
            Object element = iterator2.next();  
            System.out.println("remove: "+element);  
            iterator2.remove();  
        }         
        Iterator iterator3 = collection.iterator();  
        if (!iterator3.hasNext()) {//察看是否还有元素  
            System.out.println("还有元素");  
        }     
        if(collection.isEmpty())  
            System.out.println("collection is Empty!");  
        //使用collection.isEmpty()方法来判断  
    }  
} 
</pre>

<p>程序的运行结果为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
iterator = s1  
iterator = s2  
iterator = s3  
collection is not Empty! size=3  
remove: s1  
remove: s2  
remove: s3  
还有元素  
collection is Empty! 
</pre>

<p>可以看到，Java的Collection的Iterator 能够用来：</p>
<ol>
<li>使用方法　iterator() 要求容器返回一个Iterator .第一次调用Iterator 的next() 方法时，它返回集合序列的第一个元素。</li>
<li>使用next() 获得集合序列的中的下一个元素。</li>
<li>使用hasNext()检查序列中是否元素。</li>
<li>使用remove()将迭代器新返回的元素删除。</li>
</ol>
<p>需要注意的是,方法删除由next方法返回的最后一个元素，在每次调用next时，remove方法只能被调用一次。</p>
<p>Java 实现的这个迭代器的使用就是如此的简单。Iterator（跌代器）虽然功能简单，但仍然可以帮助我们解决许多问题，同时针对List 还有一个更复杂更高级ListIterator。您可以在下面的List讲解中得到进一步的介绍。</p>
</s.length;i++){></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2012/11/Java-集合框架-2012-11-24-java-collection-3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2012/11/Java-集合框架-2012-11-24-java-collection-3.html" itemprop="url">
                  集合框架篇3 List
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-11-22T22:40:00+08:00">
                2012-11-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2012/11/Java-集合框架-2012-11-24-java-collection-3.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2012/11/Java-集合框架-2012-11-24-java-collection-3.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><p>前面我们讲述的Collection接口实际上并没有直接的实现类。而List是容器的一种，表示列表的意思。当我们不知道存储的数据有多少的情况，我们就可以使用List 来完成存储数据的工作。例如前面提到的一种场景。我们想要在保存一个应用系统当前的在线用户的信息。我们就可以使用一个List来存储。因为<strong>List的最大的特点就是能够自动的根据插入的数据量来动态改变容器的大小</strong>。下面我们先看看List接口的一些常用方法。</p>
<h2 id="2-常用方法"><a href="#2-常用方法" class="headerlink" title="2. 常用方法"></a>2. 常用方法</h2><p>List 就是列表的意思，它是Collection 的一种，即继承了 Collection 接口，以定义一个允许重复项的有序集合。该接口不但能够对列表的一部分进行处理，还添加了面向位置的操作。List 是按对象的进入顺序进行保存对象，而不做排序或编辑操作。它除了拥有Collection接口的所有的方法外还拥有一些其他的方法。</p>
<p>面向位置的操作包括插入某个元素或 Collection 的功能，还包括获取、删除或更改元素的功能。在 List 中搜索元素可以从列表的头部或尾部开始，如果找到元素，还将报告元素所在的位置。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
void add(int index, Object element): //添加对象element到位置index上  
boolean addAll(int index, Collection collection) ：//在index位置后添加容器collection中所有的元素  
Object get(int index) ：//取出下标为index的位置的元素  
int indexOf(Object element) ：//查找对象element 在List中第一次出现的位置  
int lastIndexOf(Object element) ：//查找对象element 在List中最后出现的位置  
Object remove(int index) ：//删除index位置上的元素  
Object set(int index, Object element) ：//将index位置上的对象替换为  element 并返回老的元素。
</pre>

<h2 id="3-List的实现"><a href="#3-List的实现" class="headerlink" title="3. List的实现"></a>3. List的实现</h2><p>先看一下下面表格：</p>
<p><img src="http://7u2np3.com1.z0.glb.clouddn.com/blog%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-25%20%E4%B8%8B%E5%8D%888.59.44.png" alt=""></p>
<p>在“集合框架”中有两种常规的 List 实现：ArrayList 和 LinkedList。使用两种 List 实现的哪一种取决于您特定的需要。如果要支持随机访问，而不必在除尾部的任何位置插入或除去元素，那么，ArrayList 提供了可选的集合。但如果，您要频繁的从列表的中间位置添加和除去元素，而只要顺序的访问列表元素，那么，LinkedList 实现更好。</p>
<p>我们以ArrayList 为例，先看一个简单的例子：例子中，我们把12个月份存放到ArrayList 中，然后用一个循环，并使用get（）方法将列表中的对象都取出来。<br>而LinkedList 添加了一些处理列表两端元素的方法（下图只显示了新方法）：<br>使用这些新方法，您就可以轻松的把 LinkedList 当作一个堆栈、队列或其它面向端点的数据结构。<br>我们再来看另外一个使用LinkedList 来实现一个简单的队列的例子：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
import java.util.*;
public class ListExample {
  public static void main(String args[]) {
    LinkedList queue = new LinkedList();
    queue.addFirst("Bernadine");
    queue.addFirst("Elizabeth");
    queue.addFirst("Gene");
    queue.addFirst("Elizabeth");
    queue.addFirst("Clara");
    System.out.println(queue);
    queue.removeLast();
    queue.removeLast();
    System.out.println(queue);
  }
}
</pre>

<p>运行程序产生了以下输出。请注意，与 Set 不同的是 List 允许重复。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
【Clara, Elizabeth, Gene, Elizabeth, Bernadine】
【Clara, Elizabeth, Gene】
</pre>

<p>该的程序演示了具体 List 类的使用。第一部分，创建一个由 ArrayList 支持的 List。填充完列表以后，特定条目就得到了。示例的 LinkedList 部分把 LinkedList 当作一个队列，从队列头部添加东西，从尾部除去。<br>List 接口不但以位置友好的方式遍历整个列表，还能处理集合的子集：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
ListIterator listIterator() //返回一个ListIterator 跌代器，默认开始位置为０
ListIterator listIterator(int startIndex)//返回一个ListIterator 跌代器，开始startIndex
List subList(int fromIndex, int toIndex) //返回一个子列表List ,元素存放fromIndex 到toIndex之前的一个元素。
</pre>

<p>处理 subList() 时，位于 fromIndex 的元素在子列表中，而位于 toIndex 的元素则不是，提醒这一点很重要。以下 for-loop 测试案例大致反映了这一点：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
for (int i=fromIndex; i<toindex; i++)="" {="" process="" element="" at="" position="" i="" }="" <="" pre="">
此外，我们还应该提醒的是：对子列表的更改（如 add()、remove() 和 set() 调用）对底层 List 也有影响。

## 4.ListIterator 接口

ListIterator 接口继承 Iterator 接口以支持添加或更改底层集合中的元素，还支持双向访问。以下源代码演示了列表中的反向循环。请注意 ListIterator 最初位于列表尾之后（list.size()），因为第一个元素的下标是0。
<?prettify?>
<pre class="prettyprint">
List list = ...;
ListIterator iterator = list.listIterator(list.size());
while (iterator.hasPrevious()) {
  Object element = iterator.previous();
  // Process element}
</pre>

<p>正常情况下，不用 ListIterator 改变某次遍历集合元素的方向 — 向前或者向后。虽然在技术上可能实现时，但在 previous() 后立刻调用 next()，返回的是同一个元素。把调用 next() 和 previous() 的顺序颠倒一下，结果相同。我们看一个List的例子：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
import java.util.*;
public class ListIteratorTest {
    public static void main(String[] args) {
        List list = new ArrayList();
        list.add("aaa");
        list.add("bbb");
        list.add("ccc");
        list.add("ddd");    
        System.out.println("下标0开始："+list.listIterator(0).next());//next()
        System.out.println("下标1开始:"+list.listIterator(1).next());
System.out.println("子List 1-3:"+list.subList(1,3));    
//子列表    
        ListIterator it = list.listIterator();
        //默认从下标0开始
        //隐式光标属性add操作 ,插入到当前的下标的前面
        it.add("sss");
        while(it.hasNext()){
            System.out.println("next Index="+it.nextIndex()+",Object="+it.next());
        }        
        //set属性
        ListIterator it1 = list.listIterator();
        it1.next();
it1.set("ooo");
ListIterator it2 = list.listIterator(list.size());//下标
        while(it2.hasPrevious()){
            System.out.println("previous Index="+it2.previousIndex()+",Object="+it2.previous());
        }
    }
}
</pre>

<p>程序的执行结果为：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
下标0开始：aaa
下标1开始:bbb
子List 1-3:[bbb, ccc]
next Index=1,Object=aaa
next Index=2,Object=bbb
next Index=3,Object=ccc
next Index=4,Object=ddd
previous Index=4,Object=ddd
previous Index=3,Object=ccc
previous Index=2,Object=bbb
previous Index=1,Object=aaa
previous Index=0,Object=ooo
</pre>

<p>我们还需要稍微再解释一下 add() 操作。添加一个元素会导致新元素立刻被添加到隐式光标的前面。因此，添加元素后调用 previous() 会返回新元素，而调用 next() 则不起作用，返回添加操作之前的下一个元素。下标的显示方式，如下图所示：<br>对于List 的基本用法我们学会了，下面我们来进一步了解一下List的实现原理，以便价升我们对于集合的理解。</p>
<h2 id="5-实现原理"><a href="#5-实现原理" class="headerlink" title="5.实现原理"></a>5.实现原理</h2><p>前面已经提了一下Collection的实现基础都是基于数组的。下面我们就已ArrayList 为例，简单分析一下ArrayList 列表的实现方式。首先，先看下它的构造函数。<br>下列表格是在SUN提供的API中的描述：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
ArrayList()           //Constructs an empty list with an initial capacity of ten.
ArrayList(Collection c)           //Constructs a list containing the elements of the specified collection, in the order they are returned by the collection's iterator.
ArrayList(int initialCapacity)           //Constructs an empty list with the specified initial capacity.
</pre>

<p>其中第一个构造函数ArrayList()和第二构造函数ArrayList(Collection c) 是按照Collection 接口文档所述，所应该提供两个构造函数，一个无参数，一个接受另一个 Collection。<br>第3个构造函数：<br>ArrayList(int initialCapacity) 是ArrayList实现的比较重要的构造函数，虽然，我们不常用它，但是某认的构造函数正是调用的该带参数：initialCapacity 的构造函数来实现的。 其中参数：initialCapacity 表示我们构造的这个ArrayList列表的初始化容量是多大。如果调用默认的构造函数，则表示默认调用该参数为initialCapacity =10 的方式，来进行构建一个ArrayList列表对象。<br>为了更好的理解这个initialCapacity 参数的概念，我们先看看ArrayList在Sun 提供的源码中的实现方式。先看一下它的属性有哪些：<br>ArrayList 继承了AbstractList 我们主要看看ArrayList中的属性就可以了。<br>ArrayList中主要包含2个属性：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
private transient Object elementData[];
private int size;
</pre>

<p>其中数组:：elementData[] 是列表的实现核心属性：数组。 我们使用该数组来进行存放集合中的数据。而我们的初始化参数就是该数组构建时候的长度，即该数组的length属性就是initialCapacity 参数。<br>Keys：transient 表示被修饰的属性不是对象持久状态的一部分，不会自动的序列化。<br>第2个属性：size表示列表中真实数据的存放个数。<br>我们再来看一下ArrayList的构造函数,加深一下ArrayList是基于数组的理解。<br>从源码中可以看到默认的构造函数调用的就是带参数的构造函数：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
public ArrayList(int initialCapacity)
</pre>

<p>不过参数initialCapacity＝10　。<br>我们主要看ArrayList(int initialCapacity)　这个构造函数。可以看到：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
this.elementData = new Object[initialCapacity];
</pre>

<p>我们就是使用的initialCapacity　这个参数来创建一个Object数组。而我们所有的往该集合对象中存放的数据，就是存放到了这个Object数组中去了。我们在看看另外一个构造函数的源码：<br>这里，我们先看size() 方法的实现形式。它的作用即是返回size属性值的大小。然后我们再看另外一个构造函数public ArrayList(Collection c)　，该构造函数的作用是把另外一个容器对象中的元素存放到当前的List 对象中。</p>
<p>可以看到，首先，我们是通过调用另外一个容器对象C 的方法size()来设置当前的List对象的size属性的长度大小。</p>
<p>接下来，就是对elementData　数组进行初始化，初始化的大小为原先容器大小的1.1倍。最后，就是通过使用容器接口中的Object[] toArray(Object[] a)　方法来把当前容器中的对象都存放到新的数组elementData　中。这样就完成了一个ArrayList 的建立。<br>可能大家会存在一个问题，那就是，我们建立的这个ArrayList　是使用数组来实现的，但是数组的长度一旦被定下来，就不能改变了。而我们在给ArrayList对象中添加元素的时候，却没有长度限制。这个时候，ArrayList　中的elementData　属性就必须存在一个需要动态的扩充容量的机制。我们看下面的代码，它描述了这个扩充机制： </p>
<p>这个方法的作用就是用来判断当前的数组是否需要扩容，应该扩容多少。其中属性  modCount是继承自父类，它表示当前的对象对elementData数组进行了多少次扩容，清空，移除等操作。该属性相当于是一个对于当前List 对象的一个操作记录日志号。　我们主要看下面的代码实现：</p>
<ol>
<li>首先得到当前elementData　属性的长度oldCapacity。</li>
<li>然后通过判断oldCapacity和minCapacity参数谁大来决定是否需要扩容。</li>
</ol>
<ul>
<li>如果minCapacity大于oldCapacity，那么我们就对当前的List对象进行扩容。扩容的的策略为：取(oldCapacity * 3)/2 + 1和minCapacity之间更大的那个。然后使用数组拷贝的方法，把以前存放的数据转移到新的数组对象中。</li>
<li>如果minCapacity不大于oldCapacity那么就不进行扩容。</li>
</ul>
<p>下面我们看看上的那个ensureCapacity方法的是如何使用的:<br>上的两个ａｄｄ方法都是往List 中添加元素。每次在添加元素的时候，我们就需要判断一下，是否需要对于当前的数组进行扩容。</p>
<p>我们主要看看  public boolean add(Object o)方法，可以发现在添加一个元素到容器中的时候，首先我们会判断是否需要扩容。因为只增加一个元素，所以扩容的大小判断也就为当前的size+1来进行判断。然后，就把新添加的元素放到数组elementData中。</p>
<p>第二个方法public boolean addAll(Collection c)也是同样的原理。将新的元素放到elementData数组之后。同时改变当前List 对象的size属性。</p>
<p>类似的List 中的其他的方法也都是基于数组进行操作的。大家有兴趣可以看看源码中的更多的实现方式。<br>最后我们再看看如何判断在集合中是否已经存在某一个对象的：</p>
<p>由源码中我们可以看到，public boolean contains(Object elem)方法是通过调用public int indexOf(Object elem)方法来判断是否在集合中存在某个对象elem。我们看看indexOf方法的具体实现。</p>
<ul>
<li>首先我们判断一下elem　对象是否为null　，如果为null的话，那么遍历数组elementData　把第一个出现null的位置返回。</li>
<li>如果elem不为null 的话，我们也是遍历数组elementData　，并通过调用elem对象的equals()方法来得到第一个相等的元素的位置。</li>
</ul>
<p>这里我们可以发现，ArrayList中用来判断是否包含一个对象，调用的是各个对象自己实现的equals()方法。在前面的高级特性里面，我们可以知道：如果要判断一个类的一个实例对象是否等于另外一个对象，那么我们就需要自己覆写Object类的public boolean equals(Object obj) 方法。如果不覆写该方法的话，那么就会调用Object的equals()方法来进行判断。这就相当于比较两个对象的内存应用地址是否相等了。<br>在集合框架中，不仅仅是List，所有的集合类，如果需要判断里面是否存放了的某个对象，都是调用该对象的equals()方法来进行处理的。</p>
</toindex;></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2012/11/Java-集合框架-2012-11-22-java-collection-1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2012/11/Java-集合框架-2012-11-22-java-collection-1.html" itemprop="url">
                  集合框架篇1 容器简介
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-11-21T22:40:00+08:00">
                2012-11-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2012/11/Java-集合框架-2012-11-22-java-collection-1.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2012/11/Java-集合框架-2012-11-22-java-collection-1.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-容器集合"><a href="#1-容器集合" class="headerlink" title="1.容器集合"></a>1.容器集合</h2><p>Java里面最重要，最常用也就是集合(Collection, List, Set,Map)一部分了。能够用好集合和理解好集合对于做Java程序的开发拥有无比的好处。本文详细解释了关于Java中的集合是如何实现的，以及他们的实现原理。</p>
<p>到目前为止，我们已经学习了如何创建多个不同的对象，定义了这些对象以后，我们就可以利用它们来做一些有意义的事情。</p>
<p>举例来说，假设要存储许多雇员，不同的雇员的区别仅在于雇员的身份证号。我们可以通过身份证号来顺序存储每个雇员，但是在内存中实现呢？是不是要准备足够的内存来存储1000个雇员，然后再将这些雇员逐一插入？如果已经插入了500条记录，这时需要插入一个身份证号较低的新雇员，该怎么办呢？是在内存中将500条记录全部下移后，再从开头插入新的记录? 还是创建一个映射来记住每个对象的位置？当决定如何存储对象的集合时，必须考虑如下问题。</p>
<p>对于对象集合，必须执行的操作主要以下三种：</p>
<ol>
<li>添加新的对象</li>
<li>删除对象</li>
<li>查找对象</li>
</ol>
<p>我们必须确定如何将新的对象添加到集合中。可以将对象添加到集合的末尾、开头或者中间的某个逻辑位置。</p>
<p>从集合中删除一个对象后，对象集合中现有对象会有什么影响呢？可能必须将内存移来移去，或者就在现有对象所驻留的内存位置下一个“洞”。</p>
<p>在内存中建立对象集合后，必须确定如何定位特定对象。可建立一种机制，利用该机制可根据某些搜索条件（例如身份证号）直接定位到目标对象；否则，便需要遍历集合中的每个对象，直到找到要查找的对象为止。</p>
<p>数组的作用是可以存取一组数据。但是它却存在一些缺点，使得无法使用它来比较方便快捷的完成上述应用场景的要求。</p>
<p>首先，在很多数情况下面，我们需要能够存储一组数据的容器，这一点虽然数组可以实现，但是如果我们<strong>需要存储的数据的个数多少并不确定</strong>。比如说：我们需要在容器里面存储某个应用系统的当前的所有的在线用户信息，而当前的在线用户信息是时刻都可能在变化的。 也就是说，我们需要一种存储数据的容器，它能够自动的改变这个容器的所能存放的数据数量的大小。这一点上，如果使用数组来存储的话，就显得十分的笨拙。</p>
<p>我们再假设这样一种场景：假定一个购物网站，经过一段时间的运行，我们已经存储了一系列的购物清单了，购物清单中有商品信息。如果我们想要知道这段时间里面有多少种商品被销售出去了。那么我们就需要一个容器<strong>能够自动的过滤掉购物清单中的关于商品的重复信息</strong>。如果使用数组，这也是很难实现的。</p>
<p>最后再想想，我们经常会遇到这种情况，我知道某个人的帐号名称，希望能够进一步了解这个人的其他的一些信息。也就是说，我们在一个地方存放一些用户信息，我们希望能够通过用户的帐号来查找到对应的该用户的其他的一些信息。再举个查字典例子：假设我们希望使用一个容器来存放单词以及对于这个单词的解释，而当我们想要查找某个单词的意思的时候，能够根据提供的单词在这个容器中找到对应的单词的解释。如果使用数组来实现的话，就更加的困难了。</p>
<p>为解决这些问题，Java里面就设计了容器集合，不同容器集合以不同的格式保存对象。</p>
<h2 id="2-数学背景"><a href="#2-数学背景" class="headerlink" title="2. 数学背景"></a>2. 数学背景</h2><p>在常见用法中，集合（collection）和数学上直观的集（set）的概念是相同的。集是一个唯一项组，也就是说组中没有重复项。实际上，“集合框架”包含了一个 Set 接口和许多具体的 Set 类。但正式的集概念却比 Java 技术提前了一个世纪，那时英国数学家 George Boole 按逻辑正式的定义了集的概念。大部分人在小学时通过我们熟悉的维恩图引入的“集的交”和“集的并”学到过一些集的理论。</p>
<p>集的基本属性如下：</p>
<ol>
<li>集内只包含每项的一个实例</li>
<li>集可以是有限的，也可以是无限的</li>
<li>可以定义抽象概念</li>
</ol>
<p>集不仅是逻辑学、数学和计算机科学的基础，对于商业和系统的日常应用来说，它也很实用。“连接池”这一概念就是数据库服务器的一个开放连接集。Web 服务器必须管理客户机和连接集。文件描述符提供了操作系统中另一个集的示例。</p>
<p>映射是一种特别的集。它是一种对（pair）集，每个对表示一个元素到另一元素的单向映射。一些映射示例有：</p>
<ol>
<li>IP 地址到域名（DNS）的映射</li>
<li>关键字到数据库记录的映射</li>
<li>字典（词到含义的映射）</li>
<li>2 进制到 10 进制转换的映射</li>
</ol>
<p>就像集一样，映射背后的思想比 Java 编程语言早的多，甚至比计算机科学还早。而Java中的Map 就是映射的一种表现形式。</p>
<h2 id="3-容器的分类"><a href="#3-容器的分类" class="headerlink" title="3. 容器的分类"></a>3. 容器的分类</h2><p>既然您已经具备了一些集的理论，您应该能够更轻松的理解“集合框架”。 “集合框架”由一组用来操作对象的接口组成。不同接口描述不同类型的组。在很大程度上，一旦您理解了接口，您就理解了框架。虽然您总要创建接口特定的实现，但访问实际集合的方法应该限制在接口方法的使用上；因此，允许您更改基本的数据结构而不必改变其它代码。</p>
<p>Java容器类类库的用途是“保存对象”，并将其划分为两个不同的概念：</p>
<p>Collection一组对立的元素，通常这些元素都服从某种规则。<strong>List必须保持元素特定的顺序，而Set 不能有重复元素。Map 一组成对的“键值对”对象。</strong>初看起来这似乎应该是一个Collection ，其元素是成对的对象，但是这样的设计实现起来太笨拙了，于是我们将Map明确的提取出来形成一个独立的概念。</p>
<p>另一方面，如果使用Collection 表示Map的部分内容，会便于查看此部分内容。因此Map一样容易扩展成多维Map ，无需增加新的概念，只要让Map中的键值对的每个“值”也是一个Map即可。</p>
<p>Collection和Map的区别在于容器中每个位置保存的元素个数。<strong>Collection 每个位置只能保存一个元素（对象）</strong>。此类容器包括：List ，它以特定的顺序保存一组元素；Set 则是元素不能重复。<strong>Map保存的是“键值对”</strong>，就像一个小型数据库。我们可以通过“键”找到该键对应的“值”。</p>
<ol>
<li>Collection – 对象之间没有指定的顺序，允许重复元素。</li>
<li>Set –  对象之间没有指定的顺序，不允许重复元素</li>
<li>List–  对象之间有指定的顺序，允许重复元素,并引入位置下标。</li>
<li>Map –  接口用于保存关键字（Key）和数值（Value）的集合，集合中的每个对象加入时都提供数值和关键字。Map 接口既不继承 Set 也不继承 Collection。</li>
</ol>
<p>List、Set、Map共同的实现基础是Object数组<br>除了四个历史集合类外，Java 2 框架还引入了六个集合实现，如下表所示。<br><img src="http://7u2np3.com1.z0.glb.clouddn.com/blog20141123212851375.png" alt=""></p>
<p>这里没有 Collection 接口的实现，接下来看一下下面的这张关于集合框架的大图：<br><img src="http://7u2np3.com1.z0.glb.clouddn.com/blog20141123212911616.png" alt=""></p>
<p>这张图看起来有点吓人，熟悉之后就会发现其实只有三种容器：Map，List和Set ，它们各自有两个三个实现版本。常用的容器用黑色粗线框表示。</p>
<p><strong>点线方框代表“接口”，虚线方框代表抽象类，而实线方框代表普通类（即具体类，而非抽象类）</strong>。虚线箭头指出一个特定的类实现了一个接口（在抽象类的情况下，则是“部分”实现了那个接口）。实线箭头指出一个类可生成箭头指向的那个类的对象。例如任何集合( Collection )都能产生一个迭代器( Iterator )，而一个List 除了能生成一个ListIterator （列表迭代器）外,还能生成一个普通迭代器,因为List 正是从集合继承来的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2012/11/Java-IO流-2010-12-04-io-5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2012/11/Java-IO流-2010-12-04-io-5.html" itemprop="url">
                  Java IO流 序列流
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-11-21T00:00:00+08:00">
                2012-11-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2012/11/Java-IO流-2010-12-04-io-5.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2012/11/Java-IO流-2010-12-04-io-5.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在学习Java IO相关的内容时，会遇到成对出现的流，为方便日后查阅，整理以下笔记内容：</p>
<p><a href="http://sguotao.com/2010/11/30/io-1/" target="_blank" rel="external">Java IO流 1 IO流的介绍</a> <br><br><a href="http://sguotao.com/2010/12/01/io-2/" target="_blank" rel="external">Java IO流 2 字符流 </a><br><br><a href="http://sguotao.com/2010/12/02/io-3/" target="_blank" rel="external">Java IO流 3 字节流 </a><br><br><a href="http://sguotao.com/2010/12/03/io-4/" target="_blank" rel="external">Java IO流 4 File类 </a><br><br><a href="http://sguotao.com/2012/11/21/io-5/" target="_blank" rel="external">Java IO流 5 序列流</a></p>
<h2 id="1-序列流"><a href="#1-序列流" class="headerlink" title="1. 序列流"></a>1. 序列流</h2><p><strong>SequenceInputStream</strong><br>特点：可以将多个读取流合并成一个流。这样操作起来很方便。 </p>
<p>原理：其实就是将每一个读取流对象存储到一个集合中。最后一个流对象结尾作为这个流的结尾。<br>两个构造函数：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
SequenceInputStream(InputStream in1,InputStream in2)    //可以将两个读取流合并成一个流
SequenceInputStream(Enumeration  &lt;? extends InputStream &gt; en) //可以将枚举中的多个流合并成一个流。 
</pre>

<p>作用：可以用于多个数据的合并.</p>
<p>注意：<strong>因为Enumeration是Vector中特有的取出方式。而Vector被ArrayList取代。 所以要使用ArrayList集合效率更高一些。那么如何获取Enumeration呢</strong>?<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
  ArrayList &lt;FileInputStream &gt;al = new ArrayList&lt;FileInputStream&gt;(); 
  for(int x=1; x<4; x++)="" al.add(new="" fileinputstream(x+".txt"));="" iterator&lt;fileinputstream&gt;="" it="al.iterator();" enumeration&lt;fileinputstream&gt;="" en="new" enumeration&lt;fileinputstream&gt;(){="" public="" boolean="" hasmoreelements()="" {="" return="" it.hasnext();="" }="" fileinputstream="" nextelement()="" it.next();="" };="" 多个流就变成了一个流，这就是数据源。="" sequenceinputstream="" sis="new" sequenceinputstream(en);="" 创建数据目的。="" fileoutputstream="" fos="new" fileoutputstream("4.txt");="" byte[]="" buf="new" byte[1024*4];="" int="" len="0;" while((len="sis.read(buf))!=-1)" fos.write(buf,0,len);="" fos.close();="" sis.close();="" <="" pre="">

<p>如果要一个对文件数据切割。一个读取对应多了输出。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
  FileInputStream fis = new FileInputStream("1.mp3"); 
  FileOutputStream fos    = null; 
  byte[] buf = new byte[1024*1024];//是一个1MB的缓冲区。 
  int len = 0; 
  int count = 1; 
  while((len=fis.read(buf))!=-1) { 
    fos = new FileOutputStream((count++)+".part); 
    fos.write(buf,0,len); 
    fos.close(); 
  } 
  fis.close();
</pre>

<p>这样就是将1.mp3文件切割成多个碎片文件。想要合并使用SequenceInputStream即可。对于切割后，合并是需要的一些源文件的信息。可以通过配置文件进行存储。该配置可以通过键=值的形式存在。然后通过Properties对象进行数据的加载和获取。 </p>
<h2 id="2-对象的序列化"><a href="#2-对象的序列化" class="headerlink" title="2. 对象的序列化"></a>2. 对象的序列化</h2><h3 id="2-1-ObjectInputStream-和ObjectOutputStream"><a href="#2-1-ObjectInputStream-和ObjectOutputStream" class="headerlink" title="2.1 ObjectInputStream 和ObjectOutputStream"></a>2.1 ObjectInputStream 和ObjectOutputStream</h3><p>可以通过这两个流对象直接操作已有对象并将对象进行本地持久化存储。存储后的对象可以进行网络传输。 </p>
<p>两个对象的特有方法：<br><strong>ObjectInputStream</strong><br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
Object readObject()//该方法抛出异常：ClassNotFountException。 
</pre>
**ObjectOutputStream**
<?prettify?>
<pre class="prettyprint">
void writeObject(Object)//被写入的对象必须实现一个接口:Serializable 否则会抛出：NotSerializableException  
</pre>

<p>Serializable：该接口其实就是一个没有方法的标记接口。 用于给类指定一个UID。该UID是通过类中的可序列化成员的数字签名运算出来的一个long 型的值。 只要是这些成员没有变化，那么该值每次运算都一样。 该值用于判断被序列化的对象和类文件是否兼容。如果被序列化的对象需要被不同的类版本所兼容。可以在类中自定义UID。定义方式：static final long serialVersionUID = 42L; </p>
<p>注意：对应静态的成员变量，不会被序列化。对应非静态也不想被序列化的成员而言，可以通过transient关键字修饰。 通常，这两个对象成对使用。 </p>
<h3 id="2-2-操作基本数据类型的流对象"><a href="#2-2-操作基本数据类型的流对象" class="headerlink" title="2.2 操作基本数据类型的流对象"></a>2.2 操作基本数据类型的流对象</h3><p><strong>DataInputStream</strong><br>DataInputStream(InputStream);<br>操作基本数据类型的方法：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
int readInt():一次读取四个字节，并将其转成int 值。 
boolean readBoolean():一次读取一个字节。 
short readShort(); 
long readLong(); 
剩下的数据类型一样。 
String readUTF():按照utf-8修改版读取字符。注意，它只能读writeUTF()写入的字符数据
</pre>

<p><strong>DataOutputStream</strong><br>DataOutputStream(OutputStream):<br>操作基本数据类型的方法:<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
writeInt(int)：一次写入四个字节。 
注意：和write(int)不同。write(int)只将该整数的最低一个8位写入。剩余三个8位丢弃。 
writeBoolean(boolean); 
writeShort(short); 
writeLong(long); 
剩下是数据类型也也一样。 
writeUTF(String):按照utf-8修改版将字符数据进行存储。只能通过readUTF 读取。 
通常只要操作基本数据类型的数据。就需要通过DataStram进行包装。通常成对使用。 
</pre>

<h3 id="2-3-操作数组的流对象"><a href="#2-3-操作数组的流对象" class="headerlink" title="2.3 操作数组的流对象"></a>2.3 操作数组的流对象</h3><p><strong>操作字节数组</strong><br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
    ByteArrayInputStream 
    ByteArrayOutputStream 
      toByteArray(); 
      toString(); 
      writeTo(OutputStream); 
</pre>

<p><strong>操作字符数组</strong><br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
    CharArrayReader 
    CharArrayWriter 
</pre>

<p>对于这些流，源是内存。目的也是内存。而且这些流并未调用系统资源。使用的就是内存中的数组。所以这些在使用的时候不需要close。操作数组的读取流在构造时，必须要明确一个数据源。所以要传入相对应的数组。 </p>
<p>对于操作数组的写入流，在构造函数可以使用空参数。因为它内置了一个可变长度数组作为缓冲区。<br>这几个流的出现其实就是通过流的读写思想在操作数组。<br>类似的对象同理： StringReader，StringWriter。</p>
<h2 id="3-编码转换"><a href="#3-编码转换" class="headerlink" title="3. 编码转换"></a>3. 编码转换</h2><p>在io 中涉及到编码转换的流是转换流和打印流。但是打印流只有输出。在转换流中是可以指定编码表的。默认情况下，都是本机默认的码表。GBK. 这个编码表怎么来的？<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
  System.getProperty("file.encoding"); 
</pre>

<p>常见码表：<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
  ASCII:美国标准信息交换码。使用的是1个字节的7位来表示该表中的字符。 
  ISO8859-1:拉丁码表。使用1个字节来表示。 
  GB2312:简体中文码表。 
  GBK：简体中文码表，比GB2312融入更多的中文文件和符号。 
  unicode:国际标准码表。都用两个字节表示一个字符。 
  UTF-8：对unicode进行优化，每一个字节都加入了标识头。 
</pre>

<p>编码转换：<br>  字符串  –&gt;字节数组  ：编码。通过getBytes(charset);<br>  字节数组–&gt;字符串  ：  解码。通过String类的构造函数完成。String(byte[],charset); </p>
<p>如果编错了，没救！ 如果编对了，解错了，有可能还有救！<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
  String s = "你好"; 
  //编码 
  byte[] b = s.getBytes("GBK"); 
  //解码
  String s1 = new String(b,"iso8859-1"); 
  System.out.println(s1);//???? 
</pre>

<p>想要还原。<br>&lt;?prettify?&gt;</p>
<pre class="prettyprint">
  /* 对s1先进行一次解码码表的编码。获取原字节数据。 
  然后在对原字节数据进行指定编码表的解码。 */ 
  byte[] b1 = s1.getBytes("iso8859-1"); 
  String s2 = new String(b1,"gbk"); 
  System.out.println(s2);//你好
</pre>

<p>这种情况在tomcat服务器会出现。</p>
<p>因为tomcat服务器默认是iso8859-1的编码表。所以客户端通过浏览器向服务端通过get提交方式提交中文数据时，服务端获取到会使用ISO8859-1进行中文数据的解码。会出现乱码。</p>
<p>这时就必须要对获取的数据进行iso8859-1编码。然后在按照页面指定的编码表进行解码即可，而对于post提交，这种方法也通用。但是post有更好的解决方式。 request.setCharacterEncoding(“utf-8”);即可。所以建立客户端提交使用post提交方式。 </p>
</4;></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2011/08/Android基础-2011-08-14-android-basic-16.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2011/08/Android基础-2011-08-14-android-basic-16.html" itemprop="url">
                  Android基础16 传感器
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-08-16T00:00:00+08:00">
                2011-08-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2011/08/Android基础-2011-08-14-android-basic-16.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2011/08/Android基础-2011-08-14-android-basic-16.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-传感器"><a href="#1-传感器" class="headerlink" title="1. 传感器"></a>1. 传感器</h2><p>传感器类型：方向、加速度(重力)、光线、磁场、距离(临近性)、温度等。 </p>
<table>
<thead>
<tr>
<th>方向传感器</th>
<th style="text-align:center">Sensor.TYPE_ORIENTATION</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>加速度(重力)传感器 | Sensor.TYPE_ACCELEROMETER<br>光线传感器 | Sensor.TYPE_LIGHT<br>磁场传感器 | Sensor.TYPE_MAGNETIC_FIELD<br>距离(临近性)传感器 | Sensor.TYPE_PROXIMITY<br>温度传感器 | Sensor.TYPE_TEMPERATURE</p>
<p>代码实现：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取某种类型的感应器</span></div><div class="line">Sensor <span class="section">sensor</span> = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</div><div class="line"><span class="comment">//注册监听，获取传感器变化值</span></div><div class="line">sensorManager.registerListener(listener, <span class="section">sensor</span>, SensorManager.SENSOR_DELAY_GAME);</div></pre></td></tr></table></figure>
<p>上面第三个参数为采样率：最快、游戏、普通、用户界面。当应用程序请求特定的采样率时，其实只是对传感器子系统的一个建议，不保证特定的采样率可用。</p>
<table>
<thead>
<tr>
<th>最快</th>
<th style="text-align:center">SensorManager.SENSOR_DELAY_FASTEST</th>
<th style="text-align:center">最低延迟，一般不是特别敏感的处理不推荐使用，该种模式可能造成手机电力大量消耗，由于传递的为原始数据，算法不处理好将会影响游戏逻辑和UI的性能。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p> 游戏 | SensorManager.SENSOR_DELAY_GAME | 游戏延迟，一般绝大多数的实时性较高的游戏都使用该级别。<br>普通 | SensorManager.SENSOR_DELAY_NORMAL | 标准延迟，对于一般的益智类或EASY级别的游戏可以使用，但过低的采样率可能对一些赛车类游戏有跳帧现象。<br>用户界面 | SensorManager.SENSOR_DELAY_UI | 一般对于屏幕方向自动旋转使用，相对节省电能和逻辑处理，一般游戏开发中我们不使用。</p>
<p>下面介绍如何获取加速度(重力)传感器和方向传感器的测量值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> TextView accelerometer;</div><div class="line">	<span class="keyword">private</span> TextView orientation;</div><div class="line">	<span class="keyword">private</span> SensorManager sensorManager;</div><div class="line">	</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.main);</div><div class="line">        <span class="comment">//①获取感应器管理器</span></div><div class="line">        sensorManager = (SensorManager) getSystemService(SENSOR_SERVICE);</div><div class="line">        accelerometer = (TextView) findViewById(R.id.accelerometer);  </div><div class="line">        orientation = (TextView) findViewById(R.id.orientation);  </div><div class="line">    &#125;</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">//②获取重力加速度传感器</span></div><div class="line">		Sensor sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</div><div class="line">		<span class="comment">//③注册监听器</span></div><div class="line">	 	sensorManager.registerListener(listener, sensor, SensorManager.SENSOR_DELAY_GAME);	</div><div class="line">		Sensor sensor1 = sensorManager.getDefaultSensor(Sensor.TYPE_ORIENTATION);<span class="comment">//获取方向传感器</span></div><div class="line">		sensorManager.registerListener(listener, sensor1, SensorManager.SENSOR_DELAY_GAME);	</div><div class="line">		<span class="keyword">super</span>.onResume();</div><div class="line">	&#125; </div><div class="line">    <span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">//④注消所有传感器监听</span></div><div class="line">    	sensorManager.unregisterListener(listener); </div><div class="line">		<span class="keyword">super</span>.onPause();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">private</span> SensorEventListener listener = <span class="keyword">new</span> SensorEventListener() &#123;		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSensorChanged</span><span class="params">(SensorEvent event)</span> </span>&#123;<span class="comment">//当传感器的值发生变化			</span></div><div class="line">			<span class="keyword">float</span> x = event.values[SensorManager.DATA_X];      </div><div class="line">        	<span class="keyword">float</span> y = event.values[SensorManager.DATA_Y];      </div><div class="line">		    <span class="keyword">float</span> z = event.values[SensorManager.DATA_Z];  </div><div class="line">		<span class="keyword">switch</span> (event.sensor.getType()) &#123;</div><div class="line">			<span class="keyword">case</span> Sensor.TYPE_ACCELEROMETER:</div><div class="line">				accelerometer.setText(<span class="string">"Accelerometer Sensor: "</span> + x + <span class="string">", "</span> + y + <span class="string">", "</span> + z); </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			<span class="keyword">case</span> Sensor.TYPE_ORIENTATION:</div><div class="line">				orientation.setText(<span class="string">"Orientation Sensor: "</span> + x + <span class="string">", "</span> + y + <span class="string">", "</span> + z); </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAccuracyChanged</span><span class="params">(Sensor sensor, <span class="keyword">int</span> accuracy)</span> </span>&#123;<span class="comment">//当传感器的精度变化时	</span></div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>方法orientation.setText(x，y，z);参数的含义</strong></p>
<ol>
<li>x该值表示方位，0代表北（North）；90代表东（East）；180代表南（South）；270代表西（West）如果x值正好是这4个值之一，并且手机是水平放置，手机的顶部对准的方向就是该值代表的方向。</li>
<li>y值表示倾斜度，或手机翘起的程度。当手机绕着X轴倾斜时该值发生变化。y值的取值范围是-180≤y值 ≤180。</li>
<li>z值来测量桌子等物体的倾斜度。<br>z值表示手机沿着Y轴的滚动角度。表示手机沿着Y轴的滚动角度。取值范围是-90≤z值≤90。假设将手机屏幕朝上水平放在桌面上，这时如果桌面是平的，z值应为0。将手机左侧逐渐抬起时，z值逐渐变小，直到手机垂直于桌面放置，这时z值是-90。将手机右侧逐渐抬起时，z值逐渐增大，    直到手机垂直于桌面放置，这时z值是90。在垂直位置时继续向右或向左滚动，z值会继续在-90至90之间变化。</li>
</ol>
<p>假设将手机屏幕朝上水平放在桌子上，这时如果桌子是完全水平的，y值应该是0（由于很少有桌子是绝对水平的，因此，该值很可能不为0，但一般都是-5和5之间的某个值）。这时从手机顶部开始抬起，直到将手机沿X轴旋转180度（屏幕向下水平放在桌面上）。在这个旋转过程中，y值会在0到-180之间变化，也就是说，从手机顶部抬起时，y的值会逐渐变小，直到等于-180。如果从手机底部开始抬起，直到将手机沿X轴旋转180度，这时y值会在0到180之间变化。也就是y值会逐渐增大，直到等于180。可以利用y值和使用方向传感器（案例：指南针）</p>
<h2 id="2-NinePatch图片"><a href="#2-NinePatch图片" class="headerlink" title="2. NinePatch图片"></a>2. NinePatch图片</h2><p><img src="http://obovytgzz.bkt.clouddn.com/9patch1.png" alt="图片1"><br>NinePatch是一种很有用的PNG图片格式，它可以在特定区域随文字大小进行缩放。如下：</p>
<p>从上图可以看到，背景图片的中间区域会随着文字的大小进行缩放。背景图片是一张NinePatch图片。 NinePatch图片可以使用android自带的draw9patch工具来制作，该工具在SDK安装路径的tools目录下。执行该工具，然后点击“File”-&gt;“open 9-path”打开一张用于制作NinePatch图片的原来图片。在画布的上方和左方的边上画线指定缩放区域，勾选“Show patches”可显示画定的区域，绿色为固定大小区域，红色为缩放区域，文字会摆放在红色区域。制作完后，点击“File” “save 9-path”保存图片，draw9patch工具会自动为图片加上*.9.png后缀。</p>
<p>把制作好的图片拷贝进项目的res/drawable目录，然后编写代码。如下：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;TextView android:layout_width=<span class="string">"wrap_content"</span> </div><div class="line">    android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">    android:<span class="built_in">text</span>=<span class="string">"退出"</span> android:textColor=<span class="string">"#330000"</span></div><div class="line">    android:<span class="built_in">background</span>=<span class="string">"@drawable/button"</span>/&gt;</div></pre></td></tr></table></figure>
<p><img src="http://obovytgzz.bkt.clouddn.com/9patch2.png" alt="图片2"></p>
<h2 id="3-触摸事件"><a href="#3-触摸事件" class="headerlink" title="3. 触摸事件"></a>3. 触摸事件</h2><h3 id="3-1-拖拽"><a href="#3-1-拖拽" class="headerlink" title="3.1 拖拽"></a>3.1 拖拽</h3><p>XML配置：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;ImageView  </div><div class="line">		android:<span class="built_in">id</span>=<span class="string">"@+id/img"</span></div><div class="line">	    android:layout_width=<span class="string">"wrap_content"</span> </div><div class="line">	    android:layout_height=<span class="string">"wrap_content"</span> </div><div class="line">	    android:scaleType=<span class="string">"matrix"</span></div><div class="line">	    android:src=<span class="string">"@drawable/bb2"</span>   /&gt;</div></pre></td></tr></table></figure>
<p>Java代码实现：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">ImageView imageView = (ImageView) findViewById(R.id.img);</div><div class="line">imageView.setOnTouchListener(<span class="keyword">new</span> MyListener());</div><div class="line"><span class="keyword">private</span> final <span class="keyword">class</span> <span class="title">MyListener</span> <span class="title">implements</span> <span class="title">OnTouchListener</span> &#123;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">float</span> x;	</div><div class="line">		<span class="keyword">private</span> <span class="keyword">float</span> y;</div><div class="line">		<span class="keyword">private</span> Matrix startMatrix = <span class="keyword">new</span> Matrix();</div><div class="line">		<span class="keyword">private</span> Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">		<span class="function"><span class="keyword">public</span> boolean <span class="title">onTouch</span>(<span class="params">View v, MotionEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">			<span class="keyword">switch</span> (<span class="keyword">event</span>.getAction()) &#123;</div><div class="line">				<span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">					x = <span class="keyword">event</span>.getX();</div><div class="line">					y = <span class="keyword">event</span>.getY();</div><div class="line">					startMatrix.<span class="keyword">set</span>(imageView.getImageMatrix());</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">					matrix.<span class="keyword">set</span>(startMatrix);</div><div class="line">					matrix.postTranslate(<span class="keyword">event</span>.getX() - x, <span class="keyword">event</span>.getY() - y);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			imageView.setImageMatrix(matrix);</div><div class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-2-多点触控"><a href="#3-2-多点触控" class="headerlink" title="3.2 多点触控"></a>3.2 多点触控</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> final <span class="keyword">class</span> <span class="title">MyListener</span> <span class="title">implements</span> <span class="title">OnTouchListener</span> &#123;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">float</span> x;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">float</span> y;</div><div class="line">		<span class="keyword">private</span> Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">		<span class="keyword">private</span> Matrix startMatrix = <span class="keyword">new</span> Matrix();</div><div class="line">		<span class="keyword">private</span> <span class="keyword">int</span> type;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">float</span> startDis;</div><div class="line">		<span class="keyword">private</span> PointF point;</div><div class="line">		<span class="function"><span class="keyword">public</span> boolean <span class="title">onTouch</span>(<span class="params">View v, MotionEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">			System.<span class="keyword">out</span>.println(<span class="keyword">event</span>.getAction());</div><div class="line">			<span class="keyword">switch</span> (<span class="keyword">event</span>.getAction()) &#123;</div><div class="line">				<span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">					type = <span class="number">1</span>;</div><div class="line">					x = <span class="keyword">event</span>.getX();</div><div class="line">					y = <span class="keyword">event</span>.getY();</div><div class="line">					startMatrix.<span class="keyword">set</span>(imageView.getImageMatrix());</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">					matrix.<span class="keyword">set</span>(startMatrix);</div><div class="line">					<span class="keyword">if</span> (type == <span class="number">1</span>)</div><div class="line">						matrix.postTranslate(<span class="keyword">event</span>.getX() - x, <span class="keyword">event</span>.getY() - y);</div><div class="line">					<span class="keyword">else</span> &#123;</div><div class="line">						<span class="keyword">float</span> scale = getDis(<span class="keyword">event</span>) / startDis;</div><div class="line">						matrix.postScale(scale, scale, point.x, point.y);</div><div class="line">					&#125;</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> MotionEvent.ACTION_POINTER_DOWN:</div><div class="line">					type = <span class="number">2</span>;</div><div class="line">					startMatrix.<span class="keyword">set</span>(imageView.getImageMatrix());</div><div class="line">					startDis = getDis(<span class="keyword">event</span>);</div><div class="line">					point = getPoint(<span class="keyword">event</span>);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			imageView.setImageMatrix(matrix);</div><div class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">float</span> <span class="title">getDis</span>(<span class="params">MotionEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">		<span class="keyword">float</span> a = <span class="keyword">event</span>.getX(<span class="number">1</span>) - <span class="keyword">event</span>.getX(<span class="number">0</span>);</div><div class="line">		<span class="keyword">float</span> b = <span class="keyword">event</span>.getY(<span class="number">1</span>) - <span class="keyword">event</span>.getY(<span class="number">0</span>);</div><div class="line">		<span class="keyword">return</span> (<span class="keyword">float</span>) Math.sqrt(a * a + b * b);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">private</span> PointF <span class="title">getPoint</span>(<span class="params">MotionEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">		<span class="keyword">float</span> x = (<span class="keyword">event</span>.getX(<span class="number">0</span>) + <span class="keyword">event</span>.getX(<span class="number">1</span>)) / <span class="number">2</span>;</div><div class="line">		<span class="keyword">float</span> y = (<span class="keyword">event</span>.getY(<span class="number">0</span>) + <span class="keyword">event</span>.getY(<span class="number">1</span>)) / <span class="number">2</span>;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PointF(x, y);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-读取SIM卡"><a href="#4-读取SIM卡" class="headerlink" title="4. 读取SIM卡"></a>4. 读取SIM卡</h2><p>文档位置：<br>android-sdk-windows\platforms\android-8\sources\ContactsProvider\src\com\android\providers\contacts\ CallLogProvider.java</p>
<h3 id="4-1-判断SIM卡属于那个运营商"><a href="#4-1-判断SIM卡属于那个运营商" class="headerlink" title="4.1 判断SIM卡属于那个运营商"></a>4.1 判断SIM卡属于那个运营商</h3><p>SIM卡的IMSI码是SIM卡唯一标识：IMSI 国际移动用户识别码（IMSI：International Mobile Subscriber Identification Number）是区别移动用户的标志，储存在SIM卡中，可用于区别移动用户的有效信息。IMSI由MCC、MNC、MSIN组成，其中MCC为移动国家号码，由3位数字组成，唯一地识别移动客户所属的国家，我国为460；MNC为网络id，由2位数字组成，用于识别移动客户所归属的移动网络，中国移动为00，中国联通为01,中国电信为03；MSIN为移动客户识别码，采用等长11位数字构成。唯一地识别国内GSM.移动通信网中移动客户。所以要区分是移动还是联通，只需取得SIM卡中的MNC字段即可。<br>需要权限</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</div><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.ACCESS_COARSE_LOCATION"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Java代码实现：<br>第一种方法:获取手机的IMSI码,并判断是中国移动\中国联通\中国电信</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">TelephonyManager telManager = (TelephonyManager) getSystemService(Context.TELEPHONY_SERVICE);</div><div class="line">        String imsi = telManager.getSubscriberId();</div><div class="line"> <span class="keyword">if</span>(imsi!=null)&#123;</div><div class="line"><span class="comment">//因为移动网络编号46000下的IMSI已经用完,所以虚拟了一个46002编号，134/159号段使用了此编号</span></div><div class="line">        <span class="keyword">if</span>(imsi.<span class="keyword">startsWith</span>(<span class="string">"46000"</span>) || imsi.<span class="keyword">startsWith</span>(<span class="string">"46002"</span>))&#123;  <span class="comment">//中国移动</span></div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(imsi.<span class="keyword">startsWith</span>(<span class="string">"46001"</span>))&#123; <span class="comment">//中国联通        </span></div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(imsi.<span class="keyword">startsWith</span>(<span class="string">"46003"</span>))&#123; <span class="comment">//中国电信</span></div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二种方法</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TelephonyManager telManager = (TelephonyManager) getSystemService(Context.TELEPHONY_SERVICE);</div><div class="line">        String <span class="keyword">operator</span> = telManager.getSimOperator();</div><div class="line"> <span class="keyword">if</span>(<span class="keyword">operator</span>!=<span class="literal">null</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">operator</span>.<span class="keyword">equals</span>(<span class="string">"46000"</span>) || <span class="keyword">operator</span>.<span class="keyword">equals</span>(<span class="string">"46002"</span>))&#123;  <span class="comment">//中国移动</span></div><div class="line">        &#125;<span class="function"><span class="keyword">else</span> <span class="title">if</span>(<span class="params"><span class="keyword">operator</span>.<span class="keyword">equals</span>(<span class="string">"46001"</span></span>))</span>&#123;<span class="comment">//中国联通</span></div><div class="line">        &#125;<span class="function"><span class="keyword">else</span> <span class="title">if</span>(<span class="params"><span class="keyword">operator</span>.<span class="keyword">equals</span>(<span class="string">"46003"</span></span>))</span>&#123;<span class="comment">//中国电信</span></div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-2-从SIM卡中获取联系人信息"><a href="#4-2-从SIM卡中获取联系人信息" class="headerlink" title="4.2 从SIM卡中获取联系人信息"></a>4.2 从SIM卡中获取联系人信息</h3><p>Android系统内部通过Contentprovider对外共享Sim卡存放的联系人等信息，你可以通过操作Contentprovider来实现Sim卡信息的添删改查操作。 需要权限：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.READ_PHONE_STATE"</span>/&gt;</div></pre></td></tr></table></figure>
<p>Java代码实现：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Uri uri = Uri.parse(<span class="string">"content://icc/adn"</span>)<span class="comment">;</span></div><div class="line">		Cursor <span class="keyword">c</span> = getContentResolver().query(uri, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>)<span class="comment">;</span></div><div class="line">		while (<span class="keyword">c</span>.moveToNext())</div><div class="line">			System.out.println(<span class="keyword">c</span>.getString(<span class="keyword">c</span>.getColumnIndex(<span class="string">"name"</span>)) + <span class="string">": "</span> </div><div class="line">        + <span class="keyword">c</span>.getString(<span class="keyword">c</span>.getColumnIndex(<span class="string">"number"</span>)))<span class="comment">;</span></div></pre></td></tr></table></figure>
<h3 id="4-3-删除呼叫记录"><a href="#4-3-删除呼叫记录" class="headerlink" title="4.3 删除呼叫记录"></a>4.3 删除呼叫记录</h3><p>需要权限</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.READ_CONTACTS"</span> /&gt;</div><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.WRITE_CONTACTS"</span> /&gt;</div></pre></td></tr></table></figure>
<p>负责存放呼叫记录的内容提供者源码在ContactsProvider项目下：</p>
<ol>
<li>源码路径：com\android\providers\contacts\CallLogProvider.java</li>
<li>使用到的数据库在：/data/data/com.android.providers.contacts/databases/contacts2.db</li>
<li>表名:calls</li>
</ol>
<p><strong>呼叫记录有三种类型</strong></p>
<ol>
<li>来电：CallLog.Calls.INCOMING_TYPE （常量值：1）</li>
<li>外拔：CallLog.Calls.OUTGOING_TYPE（常量值：2）</li>
<li>未接：CallLog.Calls.MISSED_TYPE（常量值：3）</li>
</ol>
<p>删除指定号码的来电或未接呼叫记录：Java代码实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">IncomingCallLogContentObserver observer = <span class="keyword">new</span> IncomingCallLogContentObserver(<span class="keyword">new</span> Handler());</div><div class="line">observer.setNumber(<span class="string">"5554"</span>);</div><div class="line">getContentResolver().registerContentObserver(CallLog.Calls.CONTENT_URI, <span class="literal">true</span>, observer);</div><div class="line"><span class="keyword">private</span> <span class="keyword">class</span> IncomingCallLogContentObserver <span class="keyword">extends</span> ContentObserver &#123;</div><div class="line">        <span class="keyword">private</span> <span class="built_in">String</span> <span class="built_in">number</span>;</div><div class="line">        <span class="keyword">public</span> IncomingCallLogContentObserver(Handler handler)&#123;    	 </div><div class="line">      	  <span class="keyword">super</span>(handler);      	 </div><div class="line">        &#125;</div><div class="line">        <span class="keyword">public</span> <span class="built_in">void</span> setNumber(<span class="built_in">String</span> <span class="built_in">number</span>)&#123;</div><div class="line">        	 <span class="keyword">this</span>.number = <span class="built_in">number</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">public</span> <span class="built_in">void</span> onChange(<span class="built_in">boolean</span> paramBoolean)&#123;</div><div class="line">        	ContentResolver contentResolver = getContentResolver();</div><div class="line">        	<span class="keyword">if</span>(<span class="built_in">number</span>!=<span class="literal">null</span>)&#123;              </div><div class="line">              Uri localUri = CallLog.Calls.CONTENT_URI;</div><div class="line"> Cursor cursor = contentResolver.query(localUri, <span class="keyword">new</span> <span class="built_in">String</span>[]&#123;<span class="string">"_id"</span>&#125;, <span class="string">"number=? AND (type=1 OR type=3)"</span>, </div><div class="line">              		<span class="keyword">new</span> <span class="built_in">String</span>[]&#123;<span class="built_in">number</span>&#125;, <span class="string">"_id desc limit 1"</span>);</div><div class="line">              <span class="keyword">if</span>(cursor.moveToFirst())&#123;</div><div class="line">  	            contentResolver.delete(localUri, <span class="string">"_id=?"</span>, <span class="keyword">new</span> <span class="built_in">String</span>[]&#123;cursor.getString(<span class="number">0</span>)&#125;);</div><div class="line">              &#125;</div><div class="line">              cursor.close();</div><div class="line">        	&#125;</div><div class="line">            contentResolver.unregisterContentObserver(<span class="keyword">this</span>);</div><div class="line">        &#125;｝</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2011/08/Android基础-2011-08-13-android-basic-15.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2011/08/Android基础-2011-08-13-android-basic-15.html" itemprop="url">
                  Android基础15 动画特效
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-08-13T00:00:00+08:00">
                2011-08-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2011/08/Android基础-2011-08-13-android-basic-15.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2011/08/Android基础-2011-08-13-android-basic-15.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Tween动画"><a href="#1-Tween动画" class="headerlink" title="1. Tween动画"></a>1. Tween动画</h2><p>将某个组件以渐变的方式实现透明、缩放、移动、旋转等动画效果。<br><img src="http://obovytgzz.bkt.clouddn.com/anni1.png" alt="图片1"></p>
<p>详见文档android-sdk-windows/docs/guide/topics/resources/animation-resource.html</p>
<h2 id="2-Frame动画"><a href="#2-Frame动画" class="headerlink" title="2. Frame动画"></a>2. Frame动画</h2><p>通过多个画面连续播放实现动画效果，开发步骤：</p>
<ul>
<li>把准备好的图片放进项目res/ drawable下。</li>
<li>在项目的res目录下创建文件夹anim，然后在anim文件夹下面定义动画XML文件，文件名称        可以自定义。当然也可以采用编码方式定义动画效果（使用AnimationDrawable类）。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="attr">android:oneshot</span>=<span class="string">"false"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/girl_1"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/girl_2"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/girl_3"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>为View控件绑定动画效果。调用代表动画的AnimationDrawable的start()方法开始动画。<br>详见文档 android-sdk-windows/docs/guide/topics/resources/animation-resource.html</li>
</ul>
<h2 id="3-使用动画切换Activity"><a href="#3-使用动画切换Activity" class="headerlink" title="3. 使用动画切换Activity"></a>3. 使用动画切换Activity</h2><p>在startActivity()方法调用之后调用<br>overridePendingTransition(int enterAnim, int exitAnim)方法<br>enterAnim 进入的动画资源id<br>exitAnim 退出的动画    资源id</p>
<h2 id="4-使用动画翻页"><a href="#4-使用动画翻页" class="headerlink" title="4. 使用动画翻页"></a>4. 使用动画翻页</h2><p>XML配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ViewFlipper</span></span></div><div class="line">	<span class="attr">android:id</span>=<span class="string">"@+id/viewFlipper"</span></div><div class="line">	<span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">	<span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span>&gt;</div><div class="line">   	<span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">	    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">	    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">   		<span class="attr">android:src</span>=<span class="string">"@drawable/bb2"</span>/&gt;</div><div class="line">   	<span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">	    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">	    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">   		<span class="attr">android:src</span>=<span class="string">"@drawable/bb3"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">ViewFlipper</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Java代码</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> boolean <span class="title">onTouchEvent</span>(<span class="params">MotionEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">	ViewFlipper viewFlipper = (ViewFlipper) findViewById(R.id.viewFlipper);</div><div class="line">	<span class="keyword">switch</span> (<span class="keyword">event</span>.getAction()) &#123;</div><div class="line">		<span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">			start = <span class="keyword">event</span>.getX();</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">			<span class="keyword">float</span> end = <span class="keyword">event</span>.getX();</div><div class="line">			<span class="keyword">if</span> (end &gt; start) &#123;</div><div class="line">				viewFlipper.setInAnimation(<span class="keyword">this</span>, R.anim.previous_enter);</div><div class="line">				viewFlipper.setOutAnimation(<span class="keyword">this</span>, R.anim.previous_exit);</div><div class="line">				viewFlipper.showPrevious();</div><div class="line">			&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">end &lt; start</span>) </span>&#123;</div><div class="line">				viewFlipper.setInAnimation(<span class="keyword">this</span>, R.anim.next_enter);</div><div class="line">				viewFlipper.setOutAnimation(<span class="keyword">this</span>, R.anim.next_exit);</div><div class="line">				viewFlipper.showNext();</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> super.onTouchEvent(<span class="keyword">event</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5-动画练习"><a href="#5-动画练习" class="headerlink" title="5. 动画练习"></a>5. 动画练习</h2><h3 id="5-1-本例要实现对ImageView对象进行渐变尺寸缩放动画效果"><a href="#5-1-本例要实现对ImageView对象进行渐变尺寸缩放动画效果" class="headerlink" title="5.1 本例要实现对ImageView对象进行渐变尺寸缩放动画效果"></a>5.1 本例要实现对ImageView对象进行渐变尺寸缩放动画效果</h3><ul>
<li>在项目的res目录下创建文件夹anim，然后在anim文件夹下面定义动画XML文件,文件名称可以自定义，如：scale.xml，内容如下：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"> <span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span> </div><div class="line">    <span class="tag">&lt;<span class="name">scale</span> <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_decelerate_interpolator"</span> </span></div><div class="line">        <span class="attr">android:fromXScale</span>=<span class="string">"0.0"</span> </div><div class="line">        <span class="attr">android:fromYScale</span>=<span class="string">"0.0"</span>  </div><div class="line">        <span class="attr">android:toXScale</span>=<span class="string">"5"</span> </div><div class="line">        <span class="attr">android:toYScale</span>=<span class="string">"5"</span> </div><div class="line">        <span class="attr">android:pivotX</span>=<span class="string">"50%"</span> </div><div class="line">        <span class="attr">android:pivotY</span>=<span class="string">"50%"</span> </div><div class="line">        <span class="attr">android:fillAfter</span>=<span class="string">"false"</span> </div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"5000"</span>  /&gt; </div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>动画的进度使用interpolator控制，android提供了几个Interpolator 子类，实现了不同的速度曲线，如LinearInterpolator实现了匀速效果、Accelerateinterpolator实现了加速效果、DecelerateInterpolator实现了减速效果等。还可以定义自己的Interpolator子类，实现抛物线、自由落体等物理效果。</p>
<p>fromXScale（浮点型） 属性为动画起始时X坐标上的缩放尺寸<br>fromYScale（浮点型） 属性为动画起始时Y坐标上的缩放尺寸<br>toXScale（浮点型）   属性为动画结束时X坐标上的缩放尺寸<br>toYScale（浮点型）   属性为动画结束时Y坐标上的缩放尺寸</p>
<p>说明: 以上四种属性值<br>0.0表示收缩到没有<br>1.0表示正常无缩放<br>值小于1.0表示收缩<br>值大于1.0表示放大<br>pivotX（浮点型）     属性为动画相对于物件的X坐标的开始位置<br>pivotY（浮点型）     属性为动画相对于物件的Y坐标的开始位置 </p>
<p>说明:<br>以上两个属性值 从0%-100%中取值<br>50%为物件的X或Y方向坐标上的中点位置<br>duration（长整型）属性为动画持续时间 。说明:   时间以毫秒为单位<br>fillAfter（布尔型）属性当设置为true，该动画转化在动画结束后被应用</p>
<ul>
<li>在layout文件添加&lt;ImageView&gt;节点：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:src</span>=<span class="string">"@drawable/icon"</span></div><div class="line">   <span class="attr">android:id</span>=<span class="string">"@+id/imageView"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>说明：除了可以对&lt;ImageView&gt;实现动画效果，其实也可以对其他View实现动画效果，如：&lt;TextView&gt;</p>
<ul>
<li>在Activity里对ImageView使用前面定义好的动画效果：</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AnimationActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(<span class="type">R</span>.layout.main);</div><div class="line">		<span class="type">ImageView</span> imageView = (<span class="type">ImageView</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.imageView);</div><div class="line">		<span class="comment">//加载动画XML文件,生成动画指令</span></div><div class="line">		<span class="type">Animation</span> animation = <span class="type">AnimationUtils</span>.loadAnimation(<span class="keyword">this</span>, <span class="type">R</span>.anim.scale);</div><div class="line">		<span class="comment">//开始执行动画</span></div><div class="line">		imageView.startAnimation(animation);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>备注：上面采用的是xml文件定义动画效果，作为代替，也可以采用编码方式实现。下面采用编码方式实现上述例子同样的效果：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AnimationActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span>	</div><div class="line">	public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(<span class="type">R</span>.layout.main);</div><div class="line">		<span class="type">ImageView</span> imageView = (<span class="type">ImageView</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.imageView);</div><div class="line">		<span class="type">ScaleAnimation</span> animation = <span class="keyword">new</span> <span class="type">ScaleAnimation</span>(<span class="number">0.0</span>f, <span class="number">5</span>f, <span class="number">0.0</span>f, <span class="number">5</span>f, </div><div class="line">		<span class="type">Animation</span>.<span class="type">RELATIVE_TO_SELF</span>, <span class="number">0.5</span>f, <span class="type">Animation</span>.<span class="type">RELATIVE_TO_SELF</span>, <span class="number">0.5</span>f);</div><div class="line">		animation.setDuration(<span class="number">5000</span>); <span class="comment">//设置持续时间5秒</span></div><div class="line">		imageView.startAnimation(animation);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-2-其他动画效果定义例子"><a href="#5-2-其他动画效果定义例子" class="headerlink" title="5.2 其他动画效果定义例子"></a>5.2 其他动画效果定义例子</h3><ul>
<li>渐变透明度动画效果</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">alpha</span></span></div><div class="line">		<span class="attr">android:fromAlpha</span>=<span class="string">"0.1"</span>	</div><div class="line">		<span class="attr">android:toAlpha</span>=<span class="string">"1.0"</span></div><div class="line">		<span class="attr">android:duration</span>=<span class="string">"3000"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>编码实现透明度动画效果：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AnimationActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(<span class="type">R</span>.layout.main);</div><div class="line">		<span class="type">ImageView</span> imageView = (<span class="type">ImageView</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.imageView);</div><div class="line">		<span class="type">AlphaAnimation</span> animation = <span class="keyword">new</span> <span class="type">AlphaAnimation</span>(<span class="number">0.1</span>, <span class="number">1.0</span>); </div><div class="line">		animation.setDuration(<span class="number">5000</span>); <span class="comment">//设置持续时间5秒</span></div><div class="line">		imageView.startAnimation(animation);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>画面位置移动动画效果</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">translate</span></span></div><div class="line"><span class="attr">android:repeatCount</span>=<span class="string">"2"</span></div><div class="line"><span class="attr">android:fromXDelta</span>=<span class="string">"0"</span></div><div class="line"><span class="attr">android:fromYDelta</span>=<span class="string">"0"</span></div><div class="line"><span class="attr">android:toXDelta</span>=<span class="string">"120"</span></div><div class="line"><span class="attr">android:toYDelta</span>=<span class="string">"120"</span></div><div class="line"><span class="attr">android:duration</span>=<span class="string">"3000"</span>/&gt;</div><div class="line"><span class="comment">&lt;!-- fromXDelta fromYDelta 为动画起始时 X和Y坐标上的位置</span></div><div class="line">toXDelta toYDelta为动画结束起始时  X和Y坐标上的位置 --&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>编码实现位置移动动画效果：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AnimationActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(<span class="type">R</span>.layout.main);</div><div class="line">		<span class="type">ImageView</span> imageView = (<span class="type">ImageView</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.imageView);</div><div class="line">		<span class="type">TranslateAnimation</span> animation = <span class="keyword">new</span> <span class="type">TranslateAnimation</span>(<span class="number">0</span>, <span class="number">120</span>, <span class="number">0</span>, <span class="number">120</span>); </div><div class="line">		animation.setDuration(<span class="number">5000</span>); <span class="comment">//设置持续时间5秒</span></div><div class="line">		imageView.startAnimation(animation);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>画面旋转动画效果</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">rotate</span></span></div><div class="line"><span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_interpolator"</span></div><div class="line"><span class="attr">android:repeatCount</span>=<span class="string">"2"</span></div><div class="line"><span class="attr">android:fromDegrees</span>=<span class="string">"0"</span></div><div class="line"><span class="attr">android:toDegrees</span>=<span class="string">"+360"</span></div><div class="line"><span class="attr">android:pivotX</span>=<span class="string">"50%"</span></div><div class="line"><span class="attr">android:pivotY</span>=<span class="string">"50%"</span></div><div class="line"><span class="attr">android:duration</span>=<span class="string">"3000"</span>/&gt;</div><div class="line"><span class="comment">&lt;!-- </span></div><div class="line">repeatCount 重复次数</div><div class="line">fromDegrees为动画起始时物件的角度:</div><div class="line">当角度为负数——表示逆时针旋转</div><div class="line">当角度为正数——表示顺时针旋转</div><div class="line">(负数fromDegrees——toDegrees正数:顺时针旋转)</div><div class="line">(负数fromDegrees——toDegrees负数:逆时针旋转)</div><div class="line">(正数fromDegrees——toDegrees正数:顺时针旋转)</div><div class="line">(正数fromDegrees——toDegrees负数:逆时针旋转)</div><div class="line">toDegrees属性为动画结束时物件旋转的角度 可以大于360度</div><div class="line">pivotX,pivotY  为动画相对于物件的X、Y坐标的开始位置。说明：以上两个属性值 从0%-100%中取值,50%为物件的X或Y方向坐标上的中点位置</div><div class="line"> --&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>编码实现：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RotateAnimation animation = new RotateAnimation(<span class="number">0</span>, <span class="number">-90</span>, Animation.RELATIVE_TO_SELF, <span class="number">0.5</span>f, Animation.RELATIVE_TO_SELF, <span class="number">0.5</span>f);</div><div class="line">animation.setDuration(<span class="number">500</span>);</div><div class="line">imageView.startAnimation(animation);</div></pre></td></tr></table></figure>
<ul>
<li>Frame动画例子<br>a)    把准备好的图片放进项目res/ drawable下。图片有：girl_1.gif, girl_2.gif, girl_3.gif<br>b)    在项目的res目录下创建文件夹anim，然后在anim文件夹下面定义动画XML文件，文件名称可以自定义,如：frame.xml。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:oneshot</span>=<span class="string">"false"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/girl_1"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/girl_2"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/girl_3"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面的XML就定义了一个Frame动画，其包含3帧动画，3帧动画中分别应用了drawable中的3张图片：girl_1.gif, girl_2.gif, girl_3.gif，每帧动画持续200毫秒。android:oneshot属性如果为true，表示动画只播放一次停止在最后一帧上，如果设置为false表示动画循环播放。</p>
<p>c)    为View控件绑定动画效果，调用代表动画的AnimationDrawable的start()方法开始动画。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">FrameActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="type">AnimationDrawable</span> animationDrawable;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(<span class="type">R</span>.layout.main);</div><div class="line">		<span class="type">ImageView</span> imageView = (<span class="type">ImageView</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.imageView);</div><div class="line">		imageView.setBackgroundResource(<span class="type">R</span>.anim.frame);</div><div class="line">		animationDrawable = (<span class="type">AnimationDrawable</span>) imageView.getBackground();</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public boolean onTouchEvent(<span class="type">MotionEvent</span> event) &#123;</div><div class="line">		  <span class="keyword">if</span> (event.getAction() == <span class="type">MotionEvent</span>.<span class="type">ACTION_DOWN</span>) &#123;<span class="comment">//按下</span></div><div class="line">			  animationDrawable.start();</div><div class="line">			  <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">		  &#125;</div><div class="line">		  <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有一点需要强调的是：启动Frame动画的代码animationDrawable.start();不能应用在OnCreate()方法中，因为在OnCreate()中 AnimationDrawable还没有完全的与ImageView绑定。在OnCreate()中启动动画，只能看到第一张图片。这里在触摸事件中实现的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2011/08/Android基础-2011-08-12-android-basic-14.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2011/08/Android基础-2011-08-12-android-basic-14.html" itemprop="url">
                  Android基础14 样式与主题
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-08-12T00:00:00+08:00">
                2011-08-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2011/08/Android基础-2011-08-12-android-basic-14.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2011/08/Android基础-2011-08-12-android-basic-14.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-样式-style"><a href="#1-样式-style" class="headerlink" title="1. 样式(style)"></a>1. 样式(style)</h2><p>android中的样式和CSS样式作用相似，都是用于为界面元素定义显示风格，它是一个包含一个或者多个view控件属性的集合。如：需要定义字体的颜色和大小。在CSS中是这样定义的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">    <span class="selector-class">.ncist</span>&#123;<span class="attribute">COLOR</span>:<span class="number">#0000CC</span>;<span class="attribute">font-size</span>:<span class="number">18px</span>;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>可以像这样使用上面的css样式：<div class="ncist">华北科技</div>，在Android中可以这样定义样式：在res/values/styles.xml文件中添加以下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">“ncist”</span>&gt;</span><span class="xml"> <span class="comment">&lt;!-- 为样式定义一个全局唯一的名字--&gt;</span></span></div><div class="line">     <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">“android:textSize”</span>&gt;</span>18px<span class="tag">&lt;/<span class="name">item</span>&gt;</span> <span class="comment">&lt;!-- name属性的值为使用了该样式的View控件的属性 --&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#0000CC<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在layout文件中可以像下面这样使用上面的android样式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">....</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">style</span>=<span class="string">"@style/ncist"</span></span></div><div class="line">        <span class="attr">.....</span>  /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>&lt;style&gt;元素中有一个parent属性。这个属性可以让当前样式继承一个父样式，并且具有父样式的值。当然，如果父样式的值不符合你的需求，你也可以对它进行修改，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"ncist"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>18px<span class="tag">&lt;/<span class="name">item</span>&gt;</span> <span class="comment">&lt;!-- name属性为样式要用在的View控件持有的属性 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#0000CC<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"subncist"</span> <span class="attr">parent</span>=<span class="string">"@style/ncist"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#FF0000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>继承样式有两种定义方式</strong></p>
<ol>
<li>继承样式，在&lt;style&gt;标签中配置属性parent</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"style2"</span> <span class="attr">parent</span>=<span class="string">"@style/style1"</span>&gt;</span><span class="xml"></span></div><div class="line">			<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#FF0000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>继承样式，在name中引用其他样式</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"style2.style3"</span>&gt;</span><span class="xml"></span></div><div class="line">			<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>30sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>使用样式</strong><br>在layout文件的标签中配置style属性</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;Button  	style=<span class="string">"@style/style2.style3"</span></div><div class="line">	    		android:<span class="built_in">text</span>=<span class="string">"这是一个按钮"</span>/&gt;</div></pre></td></tr></table></figure>
<h2 id="2-主题-theme"><a href="#2-主题-theme" class="headerlink" title="2. 主题(theme)"></a>2. 主题(theme)</h2><p>android中主题也是用于为应用定义显示风格，它的定义和样式的定义相同，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">“ncistTheme</span>"&gt;</span><span class="undefined"></span></div><div class="line">	&lt;item name=“android:windowNoTitle”&gt;true&lt;/item&gt; &lt;!– 没标题 </div><div class="line">	&lt;item name=“android:windowFullscreen”&gt;?android:windowNoTitle&lt;/item&gt; &lt;!– 全屏显示 </div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面“?android:windowNoTitle”中的问号用于引用在当前主题中定义过的资源的值。下面代码显示在AndroidManifest.xml中如何为应用设置上面定义的主题：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;application android:icon=<span class="string">"@drawable/icon"</span> android:label=<span class="string">"@string/app_name"</span></div><div class="line">     android:theme=<span class="string">"@style/ncistTheme"</span>&gt;</div><div class="line">   ......</div><div class="line">&lt;/application&gt;</div></pre></td></tr></table></figure>
<p>除了可以在AndroidManifest.xml中设置主题，同样也可以在代码中设置主题，如下：<br>setTheme(R.style.ncistTheme);</p>
<h2 id="3-样式与主题的区别"><a href="#3-样式与主题的区别" class="headerlink" title="3. 样式与主题的区别"></a>3. 样式与主题的区别</h2><p>尽管在定义上，样式和主题基本相同，但是它们使用的地方不同。</p>
<ol>
<li>样式用在单独的View，如：EditText、TextView等；</li>
<li>主题通过AndroidManifest.xml中的&lt;application&gt;和&lt;activity&gt;用在整个应用或者某个 Activity，主题对整个应用或某个Activity进行全局性影响。</li>
<li>如果一个应用使用了主题，同时应用下的view也使用了样式，那么当主题和样式属性发生冲突时，样式的优先级高于主题。</li>
</ol>
<p>另外android系统也定义了一些主题，例如：<br>&lt;activity android:theme=“@android:style/Theme.Dialog”&gt;，该主题可以让Activity看起来像一个对话框，还有透明主题：@android:style/Theme.Translucent 。如果需要查阅这些主题，可以在文档的referenceandroid–&gt;R.style 中查看。</p>
<p><strong>注意：如果使用android内置的样式，IDE自动提示的“_”要替换成“.”</strong></p>
<h2 id="4-国际化与屏幕适配"><a href="#4-国际化与屏幕适配" class="headerlink" title="4. 国际化与屏幕适配"></a>4. 国际化与屏幕适配</h2><h3 id="4-1-国际化"><a href="#4-1-国际化" class="headerlink" title="4.1 国际化"></a>4.1 国际化</h3><p><img src="http://obovytgzz.bkt.clouddn.com/i18n1.png" alt="图片1"><br>在values和drawable文件夹后加上语言以及地区名，程序中需要国际化的部分使用资源ID<br>values-en-rUS ；values-zh-rCN；values-zh-rTW</p>
<p><strong>匹配规则</strong></p>
<ol>
<li>在匹配资源时先会找语言、地区完全匹配的</li>
<li>如果没有地区匹配的，则查找语言匹配的<br>如果没有语言匹配的则找默认values</li>
</ol>
<h3 id="4-2-屏幕适配"><a href="#4-2-屏幕适配" class="headerlink" title="4.2 屏幕适配"></a>4.2 屏幕适配</h3><p><img src="http://obovytgzz.bkt.clouddn.com/i18n2.png" alt="图片2"><br>在layout文件夹后加上分辨率，系统会根据屏幕尺寸自动选择，注意分辨率中的乘号是“x”不是“*”，并且大的数字在“x”之前，否则编译无法通过；如果没有匹配的分辨率会找默认layout文件夹。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2011/08/Android基础-2011-08-11-android-basic-13.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2011/08/Android基础-2011-08-11-android-basic-13.html" itemprop="url">
                  Android基础13 常用UI（下）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-08-11T00:00:00+08:00">
                2011-08-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2011/08/Android基础-2011-08-11-android-basic-13.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2011/08/Android基础-2011-08-11-android-basic-13.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-菜单-Menu"><a href="#1-菜单-Menu" class="headerlink" title="1.菜单(Menu)"></a>1.菜单(Menu)</h2><h3 id="1-1-普通menu"><a href="#1-1-普通menu" class="headerlink" title="1.1 普通menu"></a>1.1 普通menu</h3><p><img src="http://obovytgzz.bkt.clouddn.com/menu1.png" alt="图片1"></p>
<ol>
<li>重写Activity的onCreateOptionsMenu(Menu menu)方法，该方法用于创建选项菜单，在用户按下手机的“Menu”按钮时就会显示创建好的菜单，在onCreateOptionsMenu(Menu menu)方法内部可以调用Menu.add()方法实现菜单的添加。</li>
<li>重写Activity的onMenuItemSelected()方法，该方法用于处理菜单被选择事件</li>
<li>通过手机上提供的“MENU”按钮可以打开菜单，如果希望通过代码打开菜单，可以调用Activity的openOptionsMenu()方法。</li>
</ol>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MenuActivity"</span>;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MENU_ADD = Menu.FIRST;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MENU_UPDATE = Menu.FIRST + <span class="number">1</span>;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.menu); </div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</div><div class="line">		menu.add(Menu.NONE, MENU_ADD, Menu.NONE, <span class="string">"添加"</span>);  </div><div class="line">		menu.add(Menu.NONE, MENU_UPDATE, Menu.NONE, <span class="string">"更新"</span>);</div><div class="line">		<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onCreateOptionsMenu</span><span class="params">(menu)</span></span>; &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onMenuItemSelected</span><span class="params">(<span class="keyword">int</span> featureId, MenuItem item)</span> </span>&#123;</div><div class="line">		<span class="keyword">switch</span> (item.getItemId()) &#123;</div><div class="line">	  	<span class="keyword">case</span> MENU_ADD:</div><div class="line">	       Log.i(TAG, <span class="string">"add was selected"</span>);</div><div class="line">	       <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	  <span class="keyword">case</span> MENU_UPDATE:</div><div class="line">	       Log.i(TAG, <span class="string">"update was selected"</span>);</div><div class="line">	       <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	  <span class="keyword">default</span>:</div><div class="line">              <span class="keyword">return</span> <span class="keyword">super</span>.onMenuItemSelected(featureId, item);</div><div class="line">&#125; &#125;	&#125;</div></pre></td></tr></table></figure>
<h3 id="1-2-SubMenu"><a href="#1-2-SubMenu" class="headerlink" title="1.2 SubMenu"></a>1.2 SubMenu</h3><ol>
<li>添加子菜单<br>调用menu对象的addSubMenu(final CharSequence title)，该方法返回一个SubMenu对象</li>
<li>添加子菜单的菜单项<br>调用SubMenu对象的add(CharSequence title) 方法</li>
</ol>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">        menu.add(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">"苹果"</span>);</div><div class="line">        menu.add(<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="string">"香蕉"</span>);</div><div class="line">        SubMenu subMenu = menu.addSubMenu(<span class="number">1</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="string">"桃子"</span>);</div><div class="line">        subMenu.add(<span class="number">2</span>, <span class="number">101</span>, <span class="number">101</span>, <span class="string">"大桃子"</span>);</div><div class="line">        subMenu.add(<span class="number">2</span>, <span class="number">102</span>, <span class="number">102</span>, <span class="string">"小桃子"</span>);</div><div class="line">        return true;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="1-3-Context-Menu"><a href="#1-3-Context-Menu" class="headerlink" title="1.3 Context Menu"></a>1.3 Context Menu</h3><p>类似于电脑上的右键，长按某个View之后弹出来的菜单。首先在main.xml里定义若干个按钮。首先要注册一下，在onCreate方法里，如下代码：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onCreate(<span class="keyword">Bundle </span>savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState)<span class="comment">;</span></div><div class="line">        setContentView(R.layout.main)<span class="comment">;</span></div><div class="line">        <span class="keyword">b1 </span>= (<span class="keyword">Button) </span>findViewById(R.id.<span class="keyword">b1);</span></div><div class="line">        <span class="keyword">b2 </span>= (<span class="keyword">Button) </span>findViewById(R.id.<span class="keyword">b2);</span></div><div class="line">        registerForContextMenu(<span class="keyword">b1);</span></div><div class="line">        registerForContextMenu(<span class="keyword">b2);</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>然后覆盖onCreateContextMenu(ContextMenu menu, View v, ContextMenuInfo menuInfo)。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Override</div><div class="line">    public void onCreateContextMenu(ContextMenu menu, View v,</div><div class="line">            ContextMenuInfo menuInfo) &#123;</div><div class="line">        if(v==<span class="keyword">b1)&#123;</span></div><div class="line">            menu.setHeaderTitle(<span class="string">"这是1"</span>)<span class="comment">;</span></div><div class="line">            menu.<span class="keyword">add(200, </span><span class="number">200</span>, <span class="number">200</span>, <span class="string">"Context Menu 1"</span>)<span class="comment">;</span></div><div class="line">            menu.<span class="keyword">add(200, </span><span class="number">201</span>, <span class="number">201</span>, <span class="string">"Context Menu 2"</span>)<span class="comment">;</span></div><div class="line">        &#125;</div><div class="line">        else if(v==<span class="keyword">b2)&#123;</span></div><div class="line">            menu.setHeaderTitle(<span class="string">"这是2"</span>)<span class="comment">;</span></div><div class="line">            menu.<span class="keyword">add(300, </span><span class="number">300</span>, <span class="number">300</span>, <span class="string">"C 1"</span>)<span class="comment">;</span></div><div class="line">            menu.<span class="keyword">add(300, </span><span class="number">301</span>, <span class="number">301</span>, <span class="string">"C 2"</span>)<span class="comment">;</span></div><div class="line">        &#125;</div><div class="line">        super.onCreateContextMenu(menu, v, menuInfo)<span class="comment">;</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="1-4-动态Menu"><a href="#1-4-动态Menu" class="headerlink" title="1.4 动态Menu"></a>1.4 动态Menu</h3><p><img src="http://obovytgzz.bkt.clouddn.com/menu2.png" alt="图片2"><br>动态菜单就是根据不同的界面有不同的菜单。下面的代码实现这样的功能：当主界面的某个TextView的值是“M“和“N”时，弹出不同的菜单。</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean onPrepareOptionsMenu(Menu <span class="keyword">menu</span>) &#123;</div><div class="line">        String currentText = tv1.getText().toString();</div><div class="line">        <span class="keyword">if</span>(<span class="string">"M"</span>.equals(currentText))&#123;</div><div class="line">            <span class="keyword">menu</span>.<span class="keyword">clear</span>();<span class="comment">//先清掉菜单</span></div><div class="line">            MenuItem item = <span class="keyword">menu</span>.add(<span class="number">0</span>, <span class="number">400</span>, <span class="number">401</span>, <span class="string">"to N"</span>);<span class="comment">//可以通过点击这个菜单项来改变tv1的值这样(变成N)就可以测试了</span></div><div class="line">            item.setIcon(android.R.drawable.alert_dark_frame);<span class="comment">//android自带的图标</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="string">"N"</span>.equals(currentText))&#123;</div><div class="line">            <span class="keyword">menu</span>.<span class="keyword">clear</span>();<span class="comment">//先清掉菜单</span></div><div class="line">            MenuItem item = <span class="keyword">menu</span>.add(<span class="number">0</span>, <span class="number">401</span>, <span class="number">402</span>, <span class="string">"to M"</span>);<span class="comment">//可以通过点击这个菜单项来改变tv1的值这样(变成M)就可以测试了</span></div><div class="line">            item.setIcon(android.R.drawable.alert_light_frame);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">menu</span>.add(<span class="number">0</span>, <span class="number">402</span>, <span class="number">403</span>, <span class="string">"Now is "</span> + currentText);<span class="comment">//现在共有两个菜单子项</span></div><div class="line">        <span class="keyword">return</span> super.onPrepareOptionsMenu(<span class="keyword">menu</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="1-5-用xml文件方式创建Menu"><a href="#1-5-用xml文件方式创建Menu" class="headerlink" title="1.5 用xml文件方式创建Menu"></a>1.5 用xml文件方式创建Menu</h3><p>之前都是用代码的方法创建Menu,用xml配置文件也可以相当方便地制作菜单。<br>要res/目录下建一个文件夹，名为menu，下面建一个xml文件，名为menu_xml_file.xml，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">group</span> <span class="attr">android:id</span>=<span class="string">"@+id/grout_main"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">"@+id/menu_1"</span></span></div><div class="line">                <span class="attr">android:title</span>=<span class="string">"This 1"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">"@+id/menu_2"</span> </span></div><div class="line">            <span class="attr">android:title</span>=<span class="string">"This 2"</span> /&gt; </div><div class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在Activity中覆盖onCreateOptionsMenu(Menu menu)方法，代码如下：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</div><div class="line">        MenuInflater inflater = getMenuInflater();</div><div class="line">        inflater.inflate(R.menu.menu_xml_file, menu);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>其他的都和在Activity中制作菜单一样。</p>
<h2 id="2-手势识别-GestureOverlayView"><a href="#2-手势识别-GestureOverlayView" class="headerlink" title="2. 手势识别(GestureOverlayView)"></a>2. 手势识别(GestureOverlayView)</h2><p><img src="http://obovytgzz.bkt.clouddn.com/menu3.png" alt="图片3"></p>
<ol>
<li>建立手势库<br>使用SDK自带例子GestureBuilder建立手势库（位置：android-sdk-windows\samples\android-8\GestureBuilder）。使用GestureBuilder之前，你需要恢复其到开发环境，然后进行编绎并部署到手机上。此时，就可以使用GestureBuilder建立手势库，生成的手势库文件在SCDard上，默认文件名称为：gestures</li>
<li>在应用中加载手势库文件，然后开发手势识别代码。<br>把手势库文件gestures文件拷贝到项目的res/raw目录下。然后在布局文件中添加用于手势绘制的View：</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;android<span class="selector-class">.gesture</span><span class="selector-class">.GestureOverlayView</span></div><div class="line">		android:id=<span class="string">"@+id/gov"</span></div><div class="line">		android:layout_width=<span class="string">"fill_parent"</span></div><div class="line">		android:layout_height=<span class="string">"fill_parent"</span></div><div class="line">		android:gestureStrokeType=<span class="string">"multiple"</span>/&gt;</div></pre></td></tr></table></figure>
<ol>
<li>为View添加手势监听事件：gestureOverlayView.addOnGesturePerformedListener();</li>
<li>得到手势库：mLibrary = GestureLibraries.fromRawResource(this, R.raw.gestures);</li>
<li>加载手势库：mLibrary.load();</li>
</ol>
<p>大多数情况下，手势都是通过一笔完成。然而有一些特别的需求就需要通过多个笔画来实现，这时可以使用gestureStrokeType属性进行设置：android:gestureStrokeType=”multiple”</p>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> GestureOverlayView gestureOverlayView;</div><div class="line">    <span class="keyword">private</span> GestureLibrary mLibrary;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> state;</div><div class="line">    <span class="keyword">private</span> EditText addressText;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.main);</div><div class="line">        addressText = (EditText)<span class="keyword">this</span>.findViewById(R.id.address);</div><div class="line">        gestureOverlayView = (GestureOverlayView)<span class="keyword">this</span>.findViewById(R.id.gestures);</div><div class="line">        <span class="comment">//当用户完成一次Gesture绘制后，系统将自动调用Listener对象的onGesturePerformed()方法</span></div><div class="line">        gestureOverlayView.addOnGesturePerformedListener(<span class="keyword">new</span> GestureListener());</div><div class="line">        mLibrary = GestureLibraries.fromRawResource(<span class="keyword">this</span>, R.raw.gestures);</div><div class="line">        state = mLibrary.load();<span class="comment">//加载手势库</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GestureListener</span> <span class="keyword">implements</span> <span class="title">GestureOverlayView</span>.<span class="title">OnGesturePerformedListener</span></span>&#123;</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGesturePerformed</span><span class="params">(GestureOverlayView overlay, Gesture gesture)</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span>(state)&#123;</div><div class="line">				List&lt;Prediction&gt; predictions = mLibrary.recognize(gesture);</div><div class="line">				<span class="comment">//从手势库中查询匹配的内容，匹配的结果可能包括多个相似的结果，匹配度高的结果放在最前面</span></div><div class="line">				<span class="keyword">if</span>(!predictions.isEmpty())&#123;</div><div class="line">					Prediction prediction = predictions.get(<span class="number">0</span>);</div><div class="line">					<span class="comment">//prediction的score属性代表了与手势的相似程度name代表手势对应的名称</span></div><div class="line">					<span class="keyword">if</span>(prediction.score &gt; <span class="number">1</span>)&#123;</div><div class="line">						addressText.setText(prediction.name);</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;    </div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-编码实现软件界面"><a href="#3-编码实现软件界面" class="headerlink" title="3. 编码实现软件界面"></a>3. 编码实现软件界面</h2><p>Android除了可以使用xml实现软件界面，还可以通过编码方式实现软件的界面，而且在某种情况下只能采用编码方式实现软件的界面，例如：软件运行时需要根据运算结果决定显示某些内容。如果不是必须，建议使用xml，因为这样可以使应用遵守mvc设计模式，具有良好的软件分层结构。下面代码实现了如HelloWorld项目一样的软件界面：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">	public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        <span class="type">LinearLayout</span> linearLayout = <span class="keyword">new</span> <span class="type">LinearLayout</span>(<span class="keyword">this</span>);</div><div class="line">        <span class="type">LinearLayout</span>.<span class="type">LayoutParams</span> layoutParams = <span class="keyword">new</span> <span class="type">LinearLayout</span>.<span class="type">LayoutParams</span>(</div><div class="line">        	<span class="type">ViewGroup</span>.<span class="type">LayoutParams</span>.<span class="type">FILL_PARENT</span>, <span class="type">ViewGroup</span>.<span class="type">LayoutParams</span>.<span class="type">FILL_PARENT</span>);</div><div class="line">        <span class="type">TextView</span> textView = <span class="keyword">new</span> <span class="type">TextView</span>(<span class="keyword">this</span>);</div><div class="line">        textView.setText(<span class="type">R</span>.string.hello);</div><div class="line">        textView.setId(<span class="number">34</span>);</div><div class="line">        <span class="type">LinearLayout</span>.<span class="type">LayoutParams</span> textParams = <span class="keyword">new</span> <span class="type">LinearLayout</span>.<span class="type">LayoutParams</span>(</div><div class="line">        	<span class="type">ViewGroup</span>.<span class="type">LayoutParams</span>.<span class="type">FILL_PARENT</span>, <span class="type">ViewGroup</span>.<span class="type">LayoutParams</span>.<span class="type">WRAP_CONTENT</span>);</div><div class="line">        linearLayout.addView(textView, textParams);</div><div class="line">        setContentView(linearLayout, layoutParams);       </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-网页视图-WebView"><a href="#4-网页视图-WebView" class="headerlink" title="4. 网页视图(WebView)"></a>4. 网页视图(WebView)</h2><p>因为android软件开发分工目前还没有细化，程序员往往需要负责软件界面的开发，虽然软件的界面图片已经由美工设计好了，但如果使用layout技术把软件做成如图片所示的界面确实很困难，而且也比较耗时。Android通过WebView实现了JS代码与Java代码互相通信的功能，使的android软件的界面开发也可以采用HTML网页技术，这样，广大网页美工可以参与进android软件的界面开发工作，从而让程序员从中解脱出来。</p>
<p>XML配置</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;WebView</div><div class="line"><span class="symbol">android:</span>id=<span class="string">"@+id/webView"</span></div><div class="line"><span class="symbol">android:</span>layout_width=<span class="string">"fill_parent"</span> </div><div class="line"><span class="symbol">android:</span>layout_height=<span class="string">"fill_parent"</span>	/&gt;</div></pre></td></tr></table></figure>
<p>在项目的assets目录放入index.html文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">jsondata</span>)</span>&#123;</div><div class="line">			        <span class="keyword">var</span> jsonobjs = <span class="built_in">eval</span>(jsondata);</div><div class="line">			        <span class="keyword">var</span> table = <span class="built_in">document</span>.getElementById(<span class="string">"personTable"</span>);</div><div class="line">			        <span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0</span>; y&lt;jsonobjs.length; y++)&#123;</div><div class="line">				        <span class="keyword">var</span> tr = table.insertRow(table.rows.length); </div><div class="line">				        <span class="keyword">var</span> td1 = tr.insertCell(<span class="number">0</span>);</div><div class="line">				        <span class="keyword">var</span> td2 = tr.insertCell(<span class="number">1</span>);</div><div class="line">				        td2.align = <span class="string">"center"</span>;</div><div class="line">				        <span class="keyword">var</span> td3 = tr.insertCell(<span class="number">2</span>);</div><div class="line">				        td3.align = <span class="string">"center"</span>;</div><div class="line">				        td1.innerHTML = jsonobjs[y].name; </div><div class="line">				        td2.innerHTML = jsonobjs[y].amount; </div><div class="line">				        td3.innerHTML = <span class="string">"&lt;a href='javascript:contact.call(\""</span>+ jsonobjs[y].phone+ <span class="string">"\")'&gt;"</span>+ jsonobjs[y].phone+ <span class="string">"&lt;/a&gt;"</span>; </div><div class="line">					&#125;</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"javascript:contact.showcontacts()"</span>&gt;</span></div><div class="line">	   <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">id</span>=<span class="string">"personTable"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">"30%"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">"30%"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>存款<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>电话<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> WebView webView;</div><div class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler();</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.main);</div><div class="line">        webView = (WebView)<span class="keyword">this</span>.findViewById(R.id.webView);</div><div class="line">        webView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">        webView.getSettings().setSaveFormData(<span class="keyword">false</span>);</div><div class="line">        webView.getSettings().setSavePassword(<span class="keyword">false</span>);</div><div class="line">        webView.getSettings().setSupportZoom(<span class="keyword">false</span>);</div><div class="line">        webView.addJavascriptInterface(<span class="keyword">new</span> NcistJavaScript(), “ncist”);</div><div class="line">		<span class="comment">//addJavascriptInterface方法中要绑定的Java对象</span></div><div class="line">        webView.setWebChromeClient(<span class="keyword">new</span> NcistWebClient());</div><div class="line">        webView.loadUrl(<span class="string">"file:///android_asset/index.html"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NcistJavaScript</span></span>&#123;</div><div class="line">    	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">personlist</span><span class="params">()</span></span>&#123;</div><div class="line">    	    webview.loadUrl(<span class="string">"javascript:contactlist('"</span>+ getPersonJson() + <span class="string">"')"</span>); </div><div class="line">		&#125;</div><div class="line">    	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(<span class="keyword">final</span> String phone)</span></span>&#123;</div><div class="line">	    startActivity(<span class="keyword">new</span> Intent(Intent.ACTION_CALL, Uri.parse(<span class="string">"tel:"</span>+ phone)));</div><div class="line">    	&#125;</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPersonJson</span><span class="params">()</span> </span>&#123;<span class="comment">//生成json字符串</span></div><div class="line">	   <span class="keyword">try</span> &#123;</div><div class="line">		JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</div><div class="line">		jsonObject.put(<span class="string">"id"</span>, <span class="number">56</span>);</div><div class="line">		jsonObject.put(<span class="string">"name"</span>, <span class="string">"老张"</span>);</div><div class="line">		jsonObject.put(<span class="string">"phone"</span>, <span class="string">"5556"</span>);    	</div><div class="line">		JSONObject jsonObject2 = <span class="keyword">new</span> JSONObject();</div><div class="line">		jsonObject2.put(<span class="string">"id"</span>, <span class="number">89</span>);</div><div class="line">		jsonObject2.put(<span class="string">"name"</span>, <span class="string">"老方"</span>);</div><div class="line">		jsonObject2.put(<span class="string">"phone"</span>, <span class="string">"5558"</span>);    	</div><div class="line">		JSONArray jsonArray = <span class="keyword">new</span> JSONArray();</div><div class="line">		jsonArray.put(jsonObject);</div><div class="line">		jsonArray.put(jsonObject2);    	</div><div class="line">		<span class="keyword">return</span> jsonArray.toString();</div><div class="line">	     &#125; <span class="keyword">catch</span> (JSONException e) &#123;</div><div class="line">		e.printStackTrace();</div><div class="line">	     &#125;</div><div class="line">	   <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NcistWebClient</span> <span class="keyword">extends</span> <span class="title">WebChromeClient</span></span>&#123;</div><div class="line">    	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    	<span class="keyword">new</span> AlertDialog.Builder(HtmlActivity.<span class="keyword">this</span>) </div><div class="line">	.setTitle(<span class="string">"提示信息"</span>)       </div><div class="line">	.setMessage(message)           </div><div class="line">	.setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener()&#123;</div><div class="line">	    	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialoginterface, <span class="keyword">int</span> i)</span></span>&#123;&#125;</div><div class="line">	&#125;).show();</div><div class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125; &#125;&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.com/blog/2011/08/Android基础-2011-08-10-android-basic-12.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott-小白">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2011/08/Android基础-2011-08-10-android-basic-12.html" itemprop="url">
                  Android基础12 常用UI（中）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-08-10T00:00:00+08:00">
                2011-08-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blog/2011/08/Android基础-2011-08-10-android-basic-12.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/blog/2011/08/Android基础-2011-08-10-android-basic-12.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-拖动条-SeekBar"><a href="#1-拖动条-SeekBar" class="headerlink" title="1. 拖动条(SeekBar)"></a>1. 拖动条(SeekBar)</h2><p><img src="http://obovytgzz.bkt.clouddn.com/ui1.png" alt="图片1"></p>
<ol>
<li>SeekBar.getProgress()获取拖动条当前值</li>
<li>调用setOnSeekBarChangeListener()方法，处理拖动条值变化事件，把SeekBar.OnSeekBarChangeListener实例作为参数传入。</li>
</ol>
<p>代码处理:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeekBarActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> SeekBar seekBar;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.seekbar);</div><div class="line">        seekBar = (SeekBar) findViewById(R.id.seekBar);</div><div class="line">        seekBar.setMax(<span class="number">100</span>);<span class="comment">//设置最大刻度</span></div><div class="line">        seekBar.setProgress(<span class="number">30</span>);<span class="comment">//设置当前刻度</span></div><div class="line">        seekBar.setOnSeekBarChangeListener(<span class="keyword">new</span> SeekBar.OnSeekBarChangeListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromTouch)</span> </span>&#123;</div><div class="line">                Log.v(<span class="string">"onProgressChanged()"</span>, String.valueOf(progress) + <span class="string">", "</span> + String.valueOf(fromTouch));</div><div class="line">            &#125;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;<span class="comment">//开始拖动</span></div><div class="line">                Log.v(<span class="string">"onStartTrackingTouch()"</span>, String.valueOf(seekBar.getProgress()));</div><div class="line">            &#125;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;<span class="comment">//结束拖动</span></div><div class="line">                Log.v(<span class="string">"onStopTrackingTouch()"</span>, String.valueOf(seekBar.getProgress()));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        Button button = (Button)<span class="keyword">this</span>.findViewById(R.id.seekBarButton);</div><div class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;			</div><div class="line">	<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">		Toast.makeText(SeekBarActivity.<span class="keyword">this</span>, String.valueOf(seekBar.getProgress()), <span class="number">1</span>).show();</div><div class="line">	&#125;&#125;);</div><div class="line">    &#125;&#125;</div></pre></td></tr></table></figure>
<h2 id="2-进度条-ProgressBar"><a href="#2-进度条-ProgressBar" class="headerlink" title="2. 进度条(ProgressBar)"></a>2. 进度条(ProgressBar)</h2><p><img src="http://obovytgzz.bkt.clouddn.com/ui2.png" alt="图片2"><br>在布局xml文件中添加进度条代码：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ProgressBar </div><div class="line">    android:layout_width=<span class="string">"fill_parent"</span> </div><div class="line">    android:layout_height=<span class="string">"20px"</span></div><div class="line">    style=<span class="string">"?android:attr/progressBarStyleHorizontal"</span></div><div class="line">    android:<span class="built_in">id</span>=<span class="string">"@+id/downloadbar"</span>/&gt;</div></pre></td></tr></table></figure>
<p>在代码中操作进度条：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Progress</span>Bar.setMax(100);//设置最大刻度</div><div class="line"><span class="keyword">Progress</span>Bar.setProgress(0);//设置进度条的当前刻度，如果进度条的最大刻度为100，当前刻度为50，进度条将进行到一半。</div></pre></td></tr></table></figure>
<h2 id="3-输入内容自动完成文本框-AutoCompleteTextView"><a href="#3-输入内容自动完成文本框-AutoCompleteTextView" class="headerlink" title="3. 输入内容自动完成文本框(AutoCompleteTextView)"></a>3. 输入内容自动完成文本框(AutoCompleteTextView)</h2><p><img src="http://obovytgzz.bkt.clouddn.com/ui3.png" alt="图片3"><br>AutoCompleteTextView和EditText组件类似，都可以输入文本。但AutoCompleteTextView组件可以和一个字符串数组或List对象绑定，当用户输入两个及以上字符时，系统将在AutoCompleteTextView组件下方列出字符串数组中所有以输入字符开头的字符串，这一点和www.google.com的搜索框非常相似，当输入某一个要查找的字符串时，google搜索框就会列出以这个字符串开头的最热门的搜索字符串列表。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;AutoCompleteTextView</div><div class="line">   android:layout_width=<span class="string">"fill_parent“  android:layout_height="</span>wrap_content“</div><div class="line">  &lt;!– completionThreshold 指定至少输入几个字符后才会出现自动提示功能 </div><div class="line">   android:completionThreshold=<span class="string">"1“  </span></div><div class="line">   android:id="@+<span class="built_in">id</span>/<span class="built_in">name</span><span class="string">" /&gt;</span></div></pre></td></tr></table></figure>
<p>代码处理：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123; ……</div><div class="line">	<span class="keyword">String</span>[] names = &#123;<span class="string">"老张"</span>, <span class="string">"老方"</span>, <span class="string">"老毕"</span>, <span class="string">"李明"</span> , <span class="string">"李丽"</span>, <span class="string">"陈江"</span>, <span class="string">"abc"</span>, <span class="string">"acc"</span>&#125;;</div><div class="line">	AutoCompleteTextView nameText = (AutoCompleteTextView)<span class="keyword">this</span>.findViewById(R.id.name);</div><div class="line">ArrayAdapter&lt;<span class="keyword">String</span>&gt; adapter = <span class="keyword">new</span> ArrayAdapter&lt;<span class="keyword">String</span>&gt;(<span class="keyword">this</span>, android.R.layout.simple_dropdown_item_1line, names);</div><div class="line">	nameText.setAdapter(adapter);&#125;</div></pre></td></tr></table></figure>
<h2 id="4-多次输入内容自动完成-MultiAutoCompleteTextView"><a href="#4-多次输入内容自动完成-MultiAutoCompleteTextView" class="headerlink" title="4. 多次输入内容自动完成(MultiAutoCompleteTextView)"></a>4. 多次输入内容自动完成(MultiAutoCompleteTextView)</h2><p><img src="http://obovytgzz.bkt.clouddn.com/ui4.png" alt="图片4"><br>除了AutoCompleteTextView控件外，我们还可以使用MultiAutoCompleteTextView控件来完成连续输入的功能。也就是说，当输入完一个字符串后，在该字符串后面输入一个逗号（,），在逗号前后可以有任意多个空格，然后再输入一个字符串，仍然会显示自动提示列表。使用MultiAutoCompleteTextView时，需要为它的setTokenizer()方法指定MultiAutoCompleteTextView.CommaTokenizer类对象实例，该对象表示采用逗号作为输入多个字符串的分隔符。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt; MultiAutoCompleteTextView</div><div class="line">   android:layout_width=<span class="string">"fill_parent“  android:layout_height="</span>wrap_content“</div><div class="line">  &lt;!– completionThreshold 指定至少输入几个字符后才会出现自动提示功能</div><div class="line">   android:completionThreshold=<span class="string">"1“  </span></div><div class="line">   android:id="@+<span class="built_in">id</span>/<span class="built_in">name</span><span class="string">" /&gt;</span></div></pre></td></tr></table></figure>
<p>代码处理</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> void onCreate(Bundle savedInstanceState) &#123;  <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">	setContentView(R.layout.main);</div><div class="line">     <span class="keyword">String</span>[] names = &#123;<span class="string">"老张"</span>, <span class="string">"老方"</span>, <span class="string">"老毕"</span>, <span class="string">"李明"</span> , <span class="string">"李丽"</span>, <span class="string">"陈江"</span>, <span class="string">"abc"</span>, <span class="string">"acc"</span>&#125;;</div><div class="line">     MultiAutoCompleteTextView nameText = (MultiAutoCompleteTextView)<span class="built_in">this</span>.findViewById(R.id.name);</div><div class="line">ArrayAdapter&lt;<span class="keyword">String</span>&gt; adapter = <span class="keyword">new</span> <span class="type">ArrayAdapter</span>&lt;<span class="keyword">String</span>&gt;(<span class="built_in">this</span>, 			  	       	android.R.layout.simple_dropdown_item_1line,names);</div><div class="line">     nameText.setAdapter(adapter);</div><div class="line">     nameText.setTokenizer(<span class="keyword">new</span> <span class="type">MultiAutoCompleteTextView</span>.CommaTokenizer());&#125;</div></pre></td></tr></table></figure>
<h2 id="5-列表视图-ListView"><a href="#5-列表视图-ListView" class="headerlink" title="5. 列表视图(ListView)"></a>5. 列表视图(ListView)</h2><p><img src="http://obovytgzz.bkt.clouddn.com/ui5.png" alt="图片5"><br>列表的显示需要三个元素：</p>
<ol>
<li>ListVeiw 用来展示列表的View。</li>
<li>适配器 用来把数据映射到ListView上的中介。</li>
<li>数据具体的将被映射的字符串，图片，或者基本组件。<br>根据列表的适配器类型，列表分为三种，ArrayAdapter，SimpleAdapter和SimpleCursorAdapter。<br>其中以ArrayAdapter最为简单，只能展示一行字。SimpleAdapter有最好的扩充性，可以自定义出各种效果。SimpleCursorAdapter可以认为是SimpleAdapter对数据库的简单结合，可以方面的把数据库的内容以列表的形式展示出来。</li>
</ol>
<h3 id="5-1-ArrayAdapter类型ListView"><a href="#5-1-ArrayAdapter类型ListView" class="headerlink" title="5.1 ArrayAdapter类型ListView"></a>5.1 ArrayAdapter类型ListView</h3><p><img src="http://obovytgzz.bkt.clouddn.com/ui6.png" alt="图片6"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyListView</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="type">ListView</span> listView;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    public void onCreate(<span class="type">Bundle</span> savedInstanceState)&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        listView = <span class="keyword">new</span> <span class="type">ListView</span>(<span class="keyword">this</span>);</div><div class="line">        listView.setAdapter(<span class="keyword">new</span> <span class="type">ArrayAdapter</span>&lt;<span class="type">String</span>&gt;(<span class="keyword">this</span>, 			android.<span class="type">R</span>.layout.simple_expandable_list_item_1,getData()));</div><div class="line">        setContentView(listView);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> <span class="type">List</span>&lt;<span class="type">String</span>&gt; getData()&#123;</div><div class="line">        <span class="type">List</span>&lt;<span class="type">String</span>&gt; data = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;<span class="type">String</span>&gt;();</div><div class="line">        data.add(<span class="string">"测试数据1"</span>);</div><div class="line">        data.add(<span class="string">"测试数据2"</span>);</div><div class="line">        data.add(<span class="string">"测试数据3"</span>);</div><div class="line">        data.add(<span class="string">"测试数据4"</span>);</div><div class="line">        <span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码使用了ArrayAdapter(Context context, int textViewResourceId, List<t> objects)来装配数据，要装配这些数据就需要一个连接ListView视图对象和数组数据的适配器来两者的适配工作，ArrayAdapter的构造需要三个参数，依次为this,布局文件（注意这里的布局文件描述的是列表的每一行的布局，android.R.layout.simple_list_item_1是系统定义好的布局文件只显示一行文字，数据源(一个List集合)。同时用setAdapter()完成适配的最后工作。</t></p>
<h3 id="5-2-SimpleCursorAdapter类型ListView"><a href="#5-2-SimpleCursorAdapter类型ListView" class="headerlink" title="5.2 SimpleCursorAdapter类型ListView"></a>5.2 SimpleCursorAdapter类型ListView</h3><p><img src="http://obovytgzz.bkt.clouddn.com/ui7.png" alt="图片7"></p>
<blockquote>
<p>sdk的解释是这样的：An easy adapter to map columns from a cursor to TextViews or ImageViews defined in an XML file. You can specify which columns you want, which views you want to display the columns, and the XML file that defines the appearance of these views。</p>
</blockquote>
<p>简单的说就是方便把从游标得到的数据进行列表显示，并可以把指定的列映射到对应的TextView中。<br>下面的程序是从电话簿中把联系人显示到类表中。先在通讯录中添加一个联系人作为数据库的数据。然后获得一个指向数据库的Cursor并且定义一个布局文件（当然也可以使用系统自带的）。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyListView2</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="type">ListView</span> listView;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    public void onCreate(<span class="type">Bundle</span> savedInstanceState)&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        listView = <span class="keyword">new</span> <span class="type">ListView</span>(<span class="keyword">this</span>);</div><div class="line">        <span class="type">Cursor</span> cursor = getContentResolver().query(<span class="type">People</span>.<span class="type">CONTENT_URI</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</div><div class="line">        startManagingCursor(cursor);</div><div class="line">        <span class="type">ListAdapter</span> listAdapter = <span class="keyword">new</span> <span class="type">SimpleCursorAdapter</span>(<span class="keyword">this</span>, 		 	android.<span class="type">R</span>.layout.simple_expandable_list_item_1, </div><div class="line">                cursor,</div><div class="line">                <span class="keyword">new</span> <span class="type">String</span>[]&#123;<span class="type">People</span>.<span class="type">NAME</span>&#125;, </div><div class="line">                <span class="keyword">new</span> int[]&#123;android.<span class="type">R</span>.id.text1&#125;);</div><div class="line">        listView.setAdapter(listAdapter);</div><div class="line">        setContentView(listView);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Cursor cursor = getContentResolver().query(People.CONTENT_URI, null, null, null, null);先获得一个指向系统通讯录数据库的Cursor对象获得数据来源。startManagingCursor(cursor);我们将获得的Cursor对象交由Activity管理，这样Cursor的生命周期和Activity便能够自动同步，省去自己手动管理Cursor。</p>
<p>SimpleCursorAdapter 构造函数前面3个参数和ArrayAdapter是一样的，最后两个参数：一个包含数据库的列的String型数组，一个包含布局文件中对应组件id的int型数组。其作用是自动的将String型数组所表示的每一列数据映射到布局文件对应id的组件上。上面的代码，将NAME列的数据一次映射到布局文件的id为text1的组件上。<br>注意：需要在AndroidManifest.xml中如权限：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.READ_CONTACTS"</span>/&gt;</div></pre></td></tr></table></figure>
<h3 id="5-3-SimpleAdapter类型ListView"><a href="#5-3-SimpleAdapter类型ListView" class="headerlink" title="5.3 SimpleAdapter类型ListView"></a>5.3 SimpleAdapter类型ListView</h3><p><img src="http://obovytgzz.bkt.clouddn.com/ui8.png" alt="图片8"><br>SimpleAdapter的扩展性最好，可以定义各种各样的布局出来，可以放上ImageView（图片），还可以放上Button（按钮），CheckBox（复选框）等等。下面的代码都直接继承了ListActivity，ListActivity和普通的Activity没有太大的差别，不同就是对显示ListView做了许多优化，方面显示而已。下面的程序是实现一个带有图片的类表。</p>
<p>首先需要定义好一个用来显示每一个列内容的xml。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span> <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:id</span>=<span class="string">"@+id/img"</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"5px"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">"@+id/title"</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:textColor</span>=<span class="string">"#FFFFFFFF"</span></div><div class="line">            <span class="attr">android:textSize</span>=<span class="string">"22px"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">"@+id/info"</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:textColor</span>=<span class="string">"#FFFFFFFF"</span></div><div class="line">            <span class="attr">android:textSize</span>=<span class="string">"13px"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>实现代码：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> class MyListView3 extends ListActivity &#123;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        SimpleAdapter adapter = <span class="keyword">new</span> SimpleAdapter(<span class="keyword">this</span>,getData(),R.layout.vlist,</div><div class="line">                <span class="keyword">new</span> <span class="keyword">String</span>[]&#123;<span class="string">"title"</span>,<span class="string">"info"</span>,<span class="string">"img"</span>&#125;,</div><div class="line">                <span class="keyword">new</span> <span class="built_in">int</span>[]&#123;R.id.title,R.id.info,R.id.img&#125;);</div><div class="line">        setListAdapter(adapter);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">private</span> List&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt; getData() &#123;</div><div class="line">        List&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt;();</div><div class="line">        Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"title"</span>, <span class="string">"G1"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"info"</span>, <span class="string">"google 1"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"img"</span>, R.drawable.i1);</div><div class="line">        list.<span class="built_in">add</span>(<span class="built_in">map</span>);</div><div class="line"> </div><div class="line">        <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"title"</span>, <span class="string">"G2"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"info"</span>, <span class="string">"google 2"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"img"</span>, R.drawable.i2);</div><div class="line">        list.<span class="built_in">add</span>(<span class="built_in">map</span>);</div><div class="line"> </div><div class="line">        <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"title"</span>, <span class="string">"G3"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"info"</span>, <span class="string">"google 3"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"img"</span>, R.drawable.i3);</div><div class="line">        list.<span class="built_in">add</span>(<span class="built_in">map</span>);</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>使用simpleAdapter的数据用一般都是HashMap构成的List，list的每一节对应ListView的每一行。HashMap的每个键值数据映射到布局文件中对应id的组件上。因为系统没有对应的布局文件可用，我们可以自己定义一个布局vlist.xml。下面做适配，new一个SimpleAdapter参数依次是：this，布局文件（vlist.xml），HashMap的 title 和 info，img。布局文件的组件id，title，info，img。布局文件的各组件分别映射到HashMap的各元素上，完成适配。</p>
<h3 id="5-4-有按钮的ListView"><a href="#5-4-有按钮的ListView" class="headerlink" title="5.4 有按钮的ListView"></a>5.4 有按钮的ListView</h3><p><img src="http://obovytgzz.bkt.clouddn.com/ui9.png" alt="图片9"><br>但是有时候，列表不光会用来做显示用，同样可以在在上面添加按钮。添加按钮首先要写一个有按钮的xml文件，然后自然会想到用上面的方法定义一个适配器，然后将数据映射到布局文件上。但是事实并非这样，因为按钮是无法映射的，即使你成功的用布局文件显示出了按钮也无法添加按钮的响应，这时就要研究一下ListView是如何现实的了，而且必须要重写一个类继承BaseAdapter.下面的示例将显示一个按钮和一个图片,两行字如果单击按钮将删除此按钮的所在行。并告诉你ListView究竟是如何工作的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:id</span>=<span class="string">"@+id/img"</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"5px"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">"@+id/title"</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:textColor</span>=<span class="string">"#FFFFFFFF"</span></div><div class="line">            <span class="attr">android:textSize</span>=<span class="string">"22px"</span> /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">"@+id/info"</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:textColor</span>=<span class="string">"#FFFFFFFF"</span></div><div class="line">            <span class="attr">android:textSize</span>=<span class="string">"13px"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">"@+id/view_btn"</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"@string/s_view_btn"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|right"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>代码实现：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> class MyListView4 extends ListActivity &#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt; mData;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        mData = getData();</div><div class="line">        MyAdapter adapter = <span class="keyword">new</span> MyAdapter(<span class="keyword">this</span>);</div><div class="line">        setListAdapter(adapter);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> List&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt; getData() &#123;</div><div class="line">        List&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;&gt;();</div><div class="line">        Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"title"</span>, <span class="string">"G1"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"info"</span>, <span class="string">"google 1"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"img"</span>, R.drawable.i1);</div><div class="line">        list.<span class="built_in">add</span>(<span class="built_in">map</span>);</div><div class="line"> </div><div class="line">        <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"title"</span>, <span class="string">"G2"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"info"</span>, <span class="string">"google 2"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"img"</span>, R.drawable.i2);</div><div class="line">        list.<span class="built_in">add</span>(<span class="built_in">map</span>);</div><div class="line"> </div><div class="line">        <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt;();</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"title"</span>, <span class="string">"G3"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"info"</span>, <span class="string">"google 3"</span>);</div><div class="line">        <span class="built_in">map</span>.put(<span class="string">"img"</span>, R.drawable.i3);</div><div class="line">        list.<span class="built_in">add</span>(<span class="built_in">map</span>);</div><div class="line">         </div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="comment">// ListView 中某项被选中后的逻辑</span></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> onListItemClick(ListView l, View v, <span class="built_in">int</span> position, <span class="keyword">long</span> id) &#123;</div><div class="line">        Log.v(<span class="string">"MyListView4-click"</span>, (<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">"title"</span>));</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * listview中点击按键弹出对话框</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> showInfo()&#123;</div><div class="line">        <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>)</div><div class="line">        .setTitle(<span class="string">"我的listview"</span>)</div><div class="line">        .setMessage(<span class="string">"介绍..."</span>)</div><div class="line">        .setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keyword">void</span> onClick(DialogInterface dialog, <span class="built_in">int</span> which) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">        .show();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> class ViewHolder&#123;</div><div class="line">        <span class="keyword">public</span> ImageView img;</div><div class="line">        <span class="keyword">public</span> TextView title;</div><div class="line">        <span class="keyword">public</span> TextView info;</div><div class="line">        <span class="keyword">public</span> Button viewBtn;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> class MyAdapter extends BaseAdapter&#123;</div><div class="line">        <span class="keyword">private</span> LayoutInflater mInflater;</div><div class="line">        <span class="keyword">public</span> MyAdapter(Context context)&#123;</div><div class="line">            <span class="keyword">this</span>.mInflater = LayoutInflater.from(context);</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="built_in">int</span> getCount() &#123;</div><div class="line">            <span class="keyword">return</span> mData.<span class="built_in">size</span>();</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keyword">Object</span> getItem(<span class="built_in">int</span> arg0) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keyword">long</span> getItemId(<span class="built_in">int</span> arg0) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">         @Override</div><div class="line">        <span class="keyword">public</span> View getView(<span class="built_in">int</span> position, View convertView, ViewGroup parent) &#123;</div><div class="line">            ViewHolder holder = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</div><div class="line">                holder=<span class="keyword">new</span> ViewHolder();  </div><div class="line">                convertView = mInflater.inflate(R.layout.vlist2, <span class="keyword">null</span>);</div><div class="line">                holder.img = (ImageView)convertView.findViewById(R.id.img);</div><div class="line">                holder.title = (TextView)convertView.findViewById(R.id.title);</div><div class="line">                holder.info = (TextView)convertView.findViewById(R.id.info);</div><div class="line">                holder.viewBtn = (Button)convertView.findViewById(R.id.view_btn);</div><div class="line">                convertView.setTag(holder);</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                holder = (ViewHolder)convertView.getTag();</div><div class="line">            &#125;</div><div class="line">            holder.img.setBackgroundResource((Integer)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">"img"</span>));</div><div class="line">            holder.title.setText((<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">"title"</span>));</div><div class="line">            holder.info.setText((<span class="keyword">String</span>)mData.<span class="built_in">get</span>(position).<span class="built_in">get</span>(<span class="string">"info"</span>));</div><div class="line">             </div><div class="line">            holder.viewBtn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">                @Override</div><div class="line">                <span class="keyword">public</span> <span class="keyword">void</span> onClick(View v) &#123;</div><div class="line">                    showInfo();                 </div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">return</span> convertView;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面将对上述代码，做详细的解释，listView在开始绘制的时候，系统首先调用getCount（）函数，根据他的返回值得到listView的长度（这也是为什么在开始的第一张图特别的标出列表长度），然后根据这个长度，调用getView（）逐一绘制每一行。如果你的getCount（）返回值是0的话，列表将不显示同样return 1，就只显示一行。</p>
<p>系统显示列表时，首先实例化一个适配器（这里将实例化自定义的适配器）。当手动完成适配时，必须手动映射数据，这需要重写getView（）方法。系统在绘制列表的每一行的时候将调用此方法。getView()有三个参数，position表示将显示的是第几行，covertView是从布局文件中inflate来的布局。我们用LayoutInflater的方法将定义好的vlist2.xml文件提取成View实例用来显示。然后将xml文件中的各个组件实例化（简单的findViewById()方法）。这样便可以将数据对应到各个组件上了。但是按钮为了响应点击事件，需要为它添加点击监听器，这样就能捕获点击事件。至此一个自定义的listView就完成了，现在让我们回过头从新审视这个过程。系统要绘制ListView了，他首先获得要绘制的这个列表的长度，然后开始绘制第一行，怎么绘制呢？调用getView()函数。在这个函数里面首先获得一个View（实际上是一个ViewGroup），然后再实例并设置各个组件，显示之。好了，绘制完这一行了。那 再绘制下一行，直到绘完为止。在实际的运行过程中会发现listView的每一行没有焦点了，这是因为Button抢夺了listView的焦点，只要布局文件中将Button设置为没有焦点就OK了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Scott" />
          <p class="site-author-name" itemprop="name">Scott</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Scott</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Scott.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  

  

  

  

</body>
</html>
