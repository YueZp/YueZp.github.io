<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="googlea8ba7e863392b1ab" />













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android,传感器," />





  <link rel="alternate" href="/atom.xml" title="Scott's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="1. 传感器传感器类型：方向、加速度(重力)、光线、磁场、距离(临近性)、温度等。     方向传感器 Sensor.TYPE_ORIENTATION         加速度(重力)传感器 | Sensor.TYPE_ACCELEROMETER光线传感器 | Sensor.TYPE_LIGHT磁场传感器 | Sensor.TYPE_MAGNETIC_FIELD距离(临近性)传感器 | Sensor">
<meta name="keywords" content="Android,传感器">
<meta property="og:type" content="article">
<meta property="og:title" content="Android基础16 传感器">
<meta property="og:url" content="http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html">
<meta property="og:site_name" content="Scott&#39;s Blog">
<meta property="og:description" content="1. 传感器传感器类型：方向、加速度(重力)、光线、磁场、距离(临近性)、温度等。     方向传感器 Sensor.TYPE_ORIENTATION         加速度(重力)传感器 | Sensor.TYPE_ACCELEROMETER光线传感器 | Sensor.TYPE_LIGHT磁场传感器 | Sensor.TYPE_MAGNETIC_FIELD距离(临近性)传感器 | Sensor">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://obovytgzz.bkt.clouddn.com/9patch1.png">
<meta property="og:image" content="http://obovytgzz.bkt.clouddn.com/9patch2.png">
<meta property="og:updated_time" content="2017-07-24T06:15:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android基础16 传感器">
<meta name="twitter:description" content="1. 传感器传感器类型：方向、加速度(重力)、光线、磁场、距离(临近性)、温度等。     方向传感器 Sensor.TYPE_ORIENTATION         加速度(重力)传感器 | Sensor.TYPE_ACCELEROMETER光线传感器 | Sensor.TYPE_LIGHT磁场传感器 | Sensor.TYPE_MAGNETIC_FIELD距离(临近性)传感器 | Sensor">
<meta name="twitter:image" content="http://obovytgzz.bkt.clouddn.com/9patch1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":true,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html"/>





  <title>Android基础16 传感器 | Scott's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?760edc77a59a2329550e2d68c6400d9b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>
    
    <!-- 在右上角或者左上角实现fork me on github -->
    <a href="https://github.com/sguotao" class="github-corner" aria-label="View source on Github"><svg width="92" height="92" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Scott's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">和光同尘,静水流深</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Scott">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Scott's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Android基础16 传感器</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-08-14T10:27:04+08:00">
                2012-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android基础/" itemprop="url" rel="index">
                    <span itemprop="name">Android基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/Android基础-2012-08-14-android-basic-16.html" class="leancloud_visitors" data-flag-title="Android基础16 传感器">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  2,608字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  12分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1-传感器"><a href="#1-传感器" class="headerlink" title="1. 传感器"></a>1. 传感器</h2><p>传感器类型：方向、加速度(重力)、光线、磁场、距离(临近性)、温度等。 </p>
<table>
<thead>
<tr>
<th>方向传感器</th>
<th style="text-align:center">Sensor.TYPE_ORIENTATION</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>加速度(重力)传感器 | Sensor.TYPE_ACCELEROMETER<br>光线传感器 | Sensor.TYPE_LIGHT<br>磁场传感器 | Sensor.TYPE_MAGNETIC_FIELD<br>距离(临近性)传感器 | Sensor.TYPE_PROXIMITY<br>温度传感器 | Sensor.TYPE_TEMPERATURE</p>
<p>代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//获取某种类型的感应器</span><br><span class="line">Sensor sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</span><br><span class="line">//注册监听，获取传感器变化值</span><br><span class="line">sensorManager.registerListener(listener, sensor, SensorManager.SENSOR_DELAY_GAME);</span><br></pre></td></tr></table></figure>
<p>上面第三个参数为采样率：最快、游戏、普通、用户界面。当应用程序请求特定的采样率时，其实只是对传感器子系统的一个建议，不保证特定的采样率可用。</p>
<table>
<thead>
<tr>
<th>最快</th>
<th style="text-align:center">SensorManager.SENSOR_DELAY_FASTEST</th>
<th style="text-align:center">最低延迟，一般不是特别敏感的处理不推荐使用，该种模式可能造成手机电力大量消耗，由于传递的为原始数据，算法不处理好将会影响游戏逻辑和UI的性能。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p> 游戏 | SensorManager.SENSOR_DELAY_GAME | 游戏延迟，一般绝大多数的实时性较高的游戏都使用该级别。<br>普通 | SensorManager.SENSOR_DELAY_NORMAL | 标准延迟，对于一般的益智类或EASY级别的游戏可以使用，但过低的采样率可能对一些赛车类游戏有跳帧现象。<br>用户界面 | SensorManager.SENSOR_DELAY_UI | 一般对于屏幕方向自动旋转使用，相对节省电能和逻辑处理，一般游戏开发中我们不使用。</p>
<p>下面介绍如何获取加速度(重力)传感器和方向传感器的测量值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">	private TextView accelerometer;</span><br><span class="line">	private TextView orientation;</span><br><span class="line">	private SensorManager sensorManager;</span><br><span class="line">	</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.main);</span><br><span class="line">        //①获取感应器管理器</span><br><span class="line">        sensorManager = (SensorManager) getSystemService(SENSOR_SERVICE);</span><br><span class="line">        accelerometer = (TextView) findViewById(R.id.accelerometer);  </span><br><span class="line">        orientation = (TextView) findViewById(R.id.orientation);  </span><br><span class="line">    &#125;</span><br><span class="line">		@Override</span><br><span class="line">		protected void onResume() &#123;</span><br><span class="line">		//②获取重力加速度传感器</span><br><span class="line">		Sensor sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</span><br><span class="line">		//③注册监听器</span><br><span class="line">	 	sensorManager.registerListener(listener, sensor, SensorManager.SENSOR_DELAY_GAME);	</span><br><span class="line">		Sensor sensor1 = sensorManager.getDefaultSensor(Sensor.TYPE_ORIENTATION);//获取方向传感器</span><br><span class="line">		sensorManager.registerListener(listener, sensor1, SensorManager.SENSOR_DELAY_GAME);	</span><br><span class="line">		super.onResume();</span><br><span class="line">	&#125; </span><br><span class="line">    @Override</span><br><span class="line">	protected void onPause() &#123;</span><br><span class="line">		//④注消所有传感器监听</span><br><span class="line">    	sensorManager.unregisterListener(listener); </span><br><span class="line">		super.onPause();</span><br><span class="line">	&#125;</span><br><span class="line">	private SensorEventListener listener = new SensorEventListener() &#123;		</span><br><span class="line">		@Override</span><br><span class="line">		public void onSensorChanged(SensorEvent event) &#123;//当传感器的值发生变化			</span><br><span class="line">			float x = event.values[SensorManager.DATA_X];      </span><br><span class="line">        	float y = event.values[SensorManager.DATA_Y];      </span><br><span class="line">		    float z = event.values[SensorManager.DATA_Z];  </span><br><span class="line">		switch (event.sensor.getType()) &#123;</span><br><span class="line">			case Sensor.TYPE_ACCELEROMETER:</span><br><span class="line">				accelerometer.setText(&quot;Accelerometer Sensor: &quot; + x + &quot;, &quot; + y + &quot;, &quot; + z); </span><br><span class="line">				break;</span><br><span class="line">			case Sensor.TYPE_ORIENTATION:</span><br><span class="line">				orientation.setText(&quot;Orientation Sensor: &quot; + x + &quot;, &quot; + y + &quot;, &quot; + z); </span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;		</span><br><span class="line">		@Override</span><br><span class="line">		public void onAccuracyChanged(Sensor sensor, int accuracy) &#123;//当传感器的精度变化时	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>方法orientation.setText(x，y，z);参数的含义</strong></p>
<ol>
<li>x该值表示方位，0代表北（North）；90代表东（East）；180代表南（South）；270代表西（West）如果x值正好是这4个值之一，并且手机是水平放置，手机的顶部对准的方向就是该值代表的方向。</li>
<li>y值表示倾斜度，或手机翘起的程度。当手机绕着X轴倾斜时该值发生变化。y值的取值范围是-180≤y值 ≤180。</li>
<li>z值来测量桌子等物体的倾斜度。<br>z值表示手机沿着Y轴的滚动角度。表示手机沿着Y轴的滚动角度。取值范围是-90≤z值≤90。假设将手机屏幕朝上水平放在桌面上，这时如果桌面是平的，z值应为0。将手机左侧逐渐抬起时，z值逐渐变小，直到手机垂直于桌面放置，这时z值是-90。将手机右侧逐渐抬起时，z值逐渐增大，    直到手机垂直于桌面放置，这时z值是90。在垂直位置时继续向右或向左滚动，z值会继续在-90至90之间变化。</li>
</ol>
<p>假设将手机屏幕朝上水平放在桌子上，这时如果桌子是完全水平的，y值应该是0（由于很少有桌子是绝对水平的，因此，该值很可能不为0，但一般都是-5和5之间的某个值）。这时从手机顶部开始抬起，直到将手机沿X轴旋转180度（屏幕向下水平放在桌面上）。在这个旋转过程中，y值会在0到-180之间变化，也就是说，从手机顶部抬起时，y的值会逐渐变小，直到等于-180。如果从手机底部开始抬起，直到将手机沿X轴旋转180度，这时y值会在0到180之间变化。也就是y值会逐渐增大，直到等于180。可以利用y值和使用方向传感器（案例：指南针）</p>
<h2 id="2-NinePatch图片"><a href="#2-NinePatch图片" class="headerlink" title="2. NinePatch图片"></a>2. NinePatch图片</h2><p><img src="http://obovytgzz.bkt.clouddn.com/9patch1.png" alt="图片1"><br>NinePatch是一种很有用的PNG图片格式，它可以在特定区域随文字大小进行缩放。如下：</p>
<p>从上图可以看到，背景图片的中间区域会随着文字的大小进行缩放。背景图片是一张NinePatch图片。 NinePatch图片可以使用android自带的draw9patch工具来制作，该工具在SDK安装路径的tools目录下。执行该工具，然后点击“File”-&gt;“open 9-path”打开一张用于制作NinePatch图片的原来图片。在画布的上方和左方的边上画线指定缩放区域，勾选“Show patches”可显示画定的区域，绿色为固定大小区域，红色为缩放区域，文字会摆放在红色区域。制作完后，点击“File” “save 9-path”保存图片，draw9patch工具会自动为图片加上*.9.png后缀。</p>
<p>把制作好的图片拷贝进项目的res/drawable目录，然后编写代码。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView android:layout_width=&quot;wrap_content&quot; </span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:text=&quot;退出&quot; android:textColor=&quot;#330000&quot;</span><br><span class="line">    android:background=&quot;@drawable/button&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://obovytgzz.bkt.clouddn.com/9patch2.png" alt="图片2"></p>
<h2 id="3-触摸事件"><a href="#3-触摸事件" class="headerlink" title="3. 触摸事件"></a>3. 触摸事件</h2><h3 id="3-1-拖拽"><a href="#3-1-拖拽" class="headerlink" title="3.1 拖拽"></a>3.1 拖拽</h3><p>XML配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView  </span><br><span class="line">		android:id=&quot;@+id/img&quot;</span><br><span class="line">	    android:layout_width=&quot;wrap_content&quot; </span><br><span class="line">	    android:layout_height=&quot;wrap_content&quot; </span><br><span class="line">	    android:scaleType=&quot;matrix&quot;</span><br><span class="line">	    android:src=&quot;@drawable/bb2&quot;   /&gt;</span><br></pre></td></tr></table></figure>
<p>Java代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ImageView imageView = (ImageView) findViewById(R.id.img);</span><br><span class="line">imageView.setOnTouchListener(new MyListener());</span><br><span class="line">private final class MyListener implements OnTouchListener &#123;</span><br><span class="line">		private float x;	</span><br><span class="line">		private float y;</span><br><span class="line">		private Matrix startMatrix = new Matrix();</span><br><span class="line">		private Matrix matrix = new Matrix();</span><br><span class="line">		public boolean onTouch(View v, MotionEvent event) &#123;</span><br><span class="line">			switch (event.getAction()) &#123;</span><br><span class="line">				case MotionEvent.ACTION_DOWN:</span><br><span class="line">					x = event.getX();</span><br><span class="line">					y = event.getY();</span><br><span class="line">					startMatrix.set(imageView.getImageMatrix());</span><br><span class="line">					break;</span><br><span class="line">				case MotionEvent.ACTION_MOVE:</span><br><span class="line">					matrix.set(startMatrix);</span><br><span class="line">					matrix.postTranslate(event.getX() - x, event.getY() - y);</span><br><span class="line">					break;</span><br><span class="line">			&#125;</span><br><span class="line">			imageView.setImageMatrix(matrix);</span><br><span class="line">			return true;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-多点触控"><a href="#3-2-多点触控" class="headerlink" title="3.2 多点触控"></a>3.2 多点触控</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">private final class MyListener implements OnTouchListener &#123;</span><br><span class="line">		private float x;</span><br><span class="line">		private float y;</span><br><span class="line">		private Matrix matrix = new Matrix();</span><br><span class="line">		private Matrix startMatrix = new Matrix();</span><br><span class="line">		private int type;</span><br><span class="line">		private float startDis;</span><br><span class="line">		private PointF point;</span><br><span class="line">		public boolean onTouch(View v, MotionEvent event) &#123;</span><br><span class="line">			System.out.println(event.getAction());</span><br><span class="line">			switch (event.getAction()) &#123;</span><br><span class="line">				case MotionEvent.ACTION_DOWN:</span><br><span class="line">					type = 1;</span><br><span class="line">					x = event.getX();</span><br><span class="line">					y = event.getY();</span><br><span class="line">					startMatrix.set(imageView.getImageMatrix());</span><br><span class="line">					break;</span><br><span class="line">				case MotionEvent.ACTION_MOVE:</span><br><span class="line">					matrix.set(startMatrix);</span><br><span class="line">					if (type == 1)</span><br><span class="line">						matrix.postTranslate(event.getX() - x, event.getY() - y);</span><br><span class="line">					else &#123;</span><br><span class="line">						float scale = getDis(event) / startDis;</span><br><span class="line">						matrix.postScale(scale, scale, point.x, point.y);</span><br><span class="line">					&#125;</span><br><span class="line">					break;</span><br><span class="line">				case MotionEvent.ACTION_POINTER_DOWN:</span><br><span class="line">					type = 2;</span><br><span class="line">					startMatrix.set(imageView.getImageMatrix());</span><br><span class="line">					startDis = getDis(event);</span><br><span class="line">					point = getPoint(event);</span><br><span class="line">					break;</span><br><span class="line">			&#125;</span><br><span class="line">			imageView.setImageMatrix(matrix);</span><br><span class="line">			return true;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	private float getDis(MotionEvent event) &#123;</span><br><span class="line">		float a = event.getX(1) - event.getX(0);</span><br><span class="line">		float b = event.getY(1) - event.getY(0);</span><br><span class="line">		return (float) Math.sqrt(a * a + b * b);</span><br><span class="line">	&#125;</span><br><span class="line">	private PointF getPoint(MotionEvent event) &#123;</span><br><span class="line">		float x = (event.getX(0) + event.getX(1)) / 2;</span><br><span class="line">		float y = (event.getY(0) + event.getY(1)) / 2;</span><br><span class="line">		return new PointF(x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-读取SIM卡"><a href="#4-读取SIM卡" class="headerlink" title="4. 读取SIM卡"></a>4. 读取SIM卡</h2><p>文档位置：<br>android-sdk-windows\platforms\android-8\sources\ContactsProvider\src\com\android\providers\contacts\ CallLogProvider.java</p>
<h3 id="4-1-判断SIM卡属于那个运营商"><a href="#4-1-判断SIM卡属于那个运营商" class="headerlink" title="4.1 判断SIM卡属于那个运营商"></a>4.1 判断SIM卡属于那个运营商</h3><p>SIM卡的IMSI码是SIM卡唯一标识：IMSI 国际移动用户识别码（IMSI：International Mobile Subscriber Identification Number）是区别移动用户的标志，储存在SIM卡中，可用于区别移动用户的有效信息。IMSI由MCC、MNC、MSIN组成，其中MCC为移动国家号码，由3位数字组成，唯一地识别移动客户所属的国家，我国为460；MNC为网络id，由2位数字组成，用于识别移动客户所归属的移动网络，中国移动为00，中国联通为01,中国电信为03；MSIN为移动客户识别码，采用等长11位数字构成。唯一地识别国内GSM.移动通信网中移动客户。所以要区分是移动还是联通，只需取得SIM卡中的MNC字段即可。<br>需要权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>Java代码实现：<br>第一种方法:获取手机的IMSI码,并判断是中国移动\中国联通\中国电信</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TelephonyManager telManager = (TelephonyManager) getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">        String imsi = telManager.getSubscriberId();</span><br><span class="line"> if(imsi!=null)&#123;</span><br><span class="line">//因为移动网络编号46000下的IMSI已经用完,所以虚拟了一个46002编号，134/159号段使用了此编号</span><br><span class="line">        if(imsi.startsWith(&quot;46000&quot;) || imsi.startsWith(&quot;46002&quot;))&#123;  //中国移动</span><br><span class="line">        &#125;else if(imsi.startsWith(&quot;46001&quot;))&#123; //中国联通        </span><br><span class="line">        &#125;else if(imsi.startsWith(&quot;46003&quot;))&#123; //中国电信</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二种方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TelephonyManager telManager = (TelephonyManager) getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">        String operator = telManager.getSimOperator();</span><br><span class="line"> if(operator!=null)&#123;</span><br><span class="line">        if(operator.equals(&quot;46000&quot;) || operator.equals(&quot;46002&quot;))&#123;  //中国移动</span><br><span class="line">        &#125;else if(operator.equals(&quot;46001&quot;))&#123;//中国联通</span><br><span class="line">        &#125;else if(operator.equals(&quot;46003&quot;))&#123;//中国电信</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-从SIM卡中获取联系人信息"><a href="#4-2-从SIM卡中获取联系人信息" class="headerlink" title="4.2 从SIM卡中获取联系人信息"></a>4.2 从SIM卡中获取联系人信息</h3><p>Android系统内部通过Contentprovider对外共享Sim卡存放的联系人等信息，你可以通过操作Contentprovider来实现Sim卡信息的添删改查操作。 需要权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>Java代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = Uri.parse(&quot;content://icc/adn&quot;);</span><br><span class="line">		Cursor c = getContentResolver().query(uri, null, null, null, null);</span><br><span class="line">		while (c.moveToNext())</span><br><span class="line">			System.out.println(c.getString(c.getColumnIndex(&quot;name&quot;)) + &quot;: &quot; </span><br><span class="line">        + c.getString(c.getColumnIndex(&quot;number&quot;)));</span><br></pre></td></tr></table></figure>
<h3 id="4-3-删除呼叫记录"><a href="#4-3-删除呼叫记录" class="headerlink" title="4.3 删除呼叫记录"></a>4.3 删除呼叫记录</h3><p>需要权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.READ_CONTACTS&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_CONTACTS&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>负责存放呼叫记录的内容提供者源码在ContactsProvider项目下：</p>
<ol>
<li>源码路径：com\android\providers\contacts\CallLogProvider.java</li>
<li>使用到的数据库在：/data/data/com.android.providers.contacts/databases/contacts2.db</li>
<li>表名:calls</li>
</ol>
<p><strong>呼叫记录有三种类型</strong></p>
<ol>
<li>来电：CallLog.Calls.INCOMING_TYPE （常量值：1）</li>
<li>外拔：CallLog.Calls.OUTGOING_TYPE（常量值：2）</li>
<li>未接：CallLog.Calls.MISSED_TYPE（常量值：3）</li>
</ol>
<p>删除指定号码的来电或未接呼叫记录：Java代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">IncomingCallLogContentObserver observer = new IncomingCallLogContentObserver(new Handler());</span><br><span class="line">observer.setNumber(&quot;5554&quot;);</span><br><span class="line">getContentResolver().registerContentObserver(CallLog.Calls.CONTENT_URI, true, observer);</span><br><span class="line">private class IncomingCallLogContentObserver extends ContentObserver &#123;</span><br><span class="line">        private String number;</span><br><span class="line">        public IncomingCallLogContentObserver(Handler handler)&#123;    	 </span><br><span class="line">      	  super(handler);      	 </span><br><span class="line">        &#125;</span><br><span class="line">        public void setNumber(String number)&#123;</span><br><span class="line">        	 this.number = number;</span><br><span class="line">        &#125;</span><br><span class="line">        public void onChange(boolean paramBoolean)&#123;</span><br><span class="line">        	ContentResolver contentResolver = getContentResolver();</span><br><span class="line">        	if(number!=null)&#123;              </span><br><span class="line">              Uri localUri = CallLog.Calls.CONTENT_URI;</span><br><span class="line"> Cursor cursor = contentResolver.query(localUri, new String[]&#123;&quot;_id&quot;&#125;, &quot;number=? AND (type=1 OR type=3)&quot;, </span><br><span class="line">              		new String[]&#123;number&#125;, &quot;_id desc limit 1&quot;);</span><br><span class="line">              if(cursor.moveToFirst())&#123;</span><br><span class="line">  	            contentResolver.delete(localUri, &quot;_id=?&quot;, new String[]&#123;cursor.getString(0)&#125;);</span><br><span class="line">              &#125;</span><br><span class="line">              cursor.close();</span><br><span class="line">        	&#125;</span><br><span class="line">            contentResolver.unregisterContentObserver(this);</span><br><span class="line">        &#125;｝</span><br></pre></td></tr></table></figure>
<hr>
<p>本文链接：<a href="http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html">http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    
      <div>
        
          
<div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center">
  <div>「真诚赞赏，手留余香」</div>
  <button id="rewardButton", disable="enable", onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}", style="cursor: pointer; border: 0; outline: 0; border-radius: 100%; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0px; text-shadow: none">
    <span onmouseover="this.style.color='rgb(236,96,0)';this.style.background='rgb(204,204,204)'" onMouseOut="this.style.color='#fff';this.style.background='rgb(236,96,0)'" style="display: inline-block; width: 70px; height: 70px; border-radius: 100%; line-height: 81px; color: #fff; font: 400 35px/75px 'microsofty'; background: rgb(236,96,0)">赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechat_pay.png" alt="Scott WeChat Pay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>微信打赏</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alibaba_pay.png" alt="Scott Alipay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>支付宝打赏</p>
      </div>
    

    

  </div>
</div>

        
      </div>
    

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      Scott
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html" title="Android基础16 传感器">http://www.sguotao.top/Android基础-2012-08-14-android-basic-16.html</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <div>
      
        
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8474352740015305",
    enable_page_level_ads: true
  });
</script>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
          
            <a href="/tags/传感器/" rel="tag"><i class="fa fa-tag"></i> 传感器</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Android基础-2012-08-13-android-basic-15.html" rel="next" title="Android基础15 动画特效">
                <i class="fa fa-chevron-left"></i> Android基础15 动画特效
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Android基础-2012-08-15-android设置全屏显示.html" rel="prev" title="Android 设置全屏显示">
                Android 设置全屏显示 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODkyOC81NDk3"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Scott" />
          <p class="site-author-name" itemprop="name">Scott</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">86</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">60</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sguotao" target="_blank" rel="external nofollow" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-传感器"><span class="nav-number">1.</span> <span class="nav-text">1. 传感器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-NinePatch图片"><span class="nav-number">2.</span> <span class="nav-text">2. NinePatch图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-触摸事件"><span class="nav-number">3.</span> <span class="nav-text">3. 触摸事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-拖拽"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 拖拽</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-多点触控"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 多点触控</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-读取SIM卡"><span class="nav-number">4.</span> <span class="nav-text">4. 读取SIM卡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-判断SIM卡属于那个运营商"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 判断SIM卡属于那个运营商</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-从SIM卡中获取联系人信息"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 从SIM卡中获取联系人信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-删除呼叫记录"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 删除呼叫记录</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Scott</span>
  <span class="with-love">
    <i class="fa fa-pencil"></i>
  </span>
  <span class="post-count">共写了191.8k字</span>
</div>



        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("iH9ug4Eu98bS8XiH30QEwODs-gzGzoHsz", "D0qgHUsqtcQOClhgS4ElkmDQ");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script>


  

</body>
</html>
